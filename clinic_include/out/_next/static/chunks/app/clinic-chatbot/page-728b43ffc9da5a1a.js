(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1103],{44415:function(e,t,n){var o={"./QUS0000000310.json":[84557,4557],"./QUS0000000324.json":[74522,4522],"./QUS0000000327.json":[811,811],"./QUS0000000328.json":[83869,3869],"./QUS0000000329.json":[4926,4926],"./QUS0000000330.json":[1197,1197],"./QUS0000000331.json":[21960,1960],"./QUS0000000332.json":[87037,7037],"./QUS0000000338.json":[89811,9811],"./QUS0000000339.json":[97068,7068],"./QUS0000000340.json":[94201,8209],"./QUS0000000341.json":[33850,3850],"./QUS0000000344.json":[84201,4201],"./QUS0000000345.json":[40869,869],"./QUS0000000346.json":[90766,766],"./QUS0000000347.json":[94204,4204],"./QUS0000000348.json":[21163,1163],"./QUS0000000349.json":[37697,7697],"./QUS0000000350.json":[88042,8042],"./QUS0000000351.json":[52160,2160],"./QUS0000000352.json":[9987,9987],"./QUS0000000353.json":[22765,2765],"./QUS0000000354.json":[49268,9268],"./QUS0000000355.json":[27864,7864],"./QUS0000000356.json":[7025,7025],"./QUS0000000383.json":[49434,9434],"./QUS0000000393.json":[65516,5516],"./QUS0000000395.json":[10652,652],"./QUS0000000396.json":[17738,7738],"./QUS0000000399.json":[10922,922],"./QUS0000000402.json":[42443,2443],"./QUS0000000403.json":[52105,2105],"./QUS0000000404.json":[49974,9974],"./QUS0000000412.json":[32086,2086],"./QUS0000000413.json":[25563,5563],"./QUS0000000414.json":[3370,3370],"./QUS0000000417.json":[44095,4095],"./QUS0000000419.json":[87247,7247],"./QUS0000000420.json":[28421,8421],"./QUS0000000423.json":[46095,6095],"./QUS0000000424.json":[33109,3109],"./QUS0000000425.json":[39854,9854],"./QUS0000000446.json":[29312,9312],"./QUS0000000447.json":[36837,6837],"./QUS0000000448.json":[55177,5177],"./QUS0000000450.json":[17503,7503],"./QUS0000000452.json":[32825,2825],"./QUS0000000453.json":[46615,6615],"./QUS0000000455.json":[61536,1536],"./QUS0000000456.json":[23532,3532],"./QUS0000000465.json":[18106,8106],"./QUS0000000466.json":[16684,6684],"./QUS0000000469.json":[75978,5978],"./QUS0000000470.json":[75186,5186],"./QUS0000000471.json":[33261,3261],"./QUS0000000473.json":[84190,4190],"./QUS0000000474.json":[44481,4481],"./QUS0000000475.json":[86351,6351],"./QUS0000000476.json":[63415,3415],"./QUS0000000478.json":[92548,2548],"./QUS0000000480.json":[93687,3687],"./QUS0000000481.json":[82273,2273],"./QUS0000000493.json":[25094,5094],"./QUS0000000498.json":[43910,3910],"./QUS0000000501.json":[53904,3904],"./QUS0000000504.json":[6313,6313],"./QUS0000000509.json":[6468,6468],"./QUS0000000510.json":[3297,3297],"./QUS0000000511.json":[43149,3149],"./QUS0000000525.json":[49502,9502],"./QUS0000000538.json":[61763,1763],"./QUS0000000540.json":[59677,9677],"./QUS0000000589.json":[5321,5321],"./QUS0000000590.json":[83767,3767],"./QUS0000000617.json":[74744,4744],"./QUS0000000631.json":[1601,1601],"./QUS0000000632.json":[28988,8988],"./QUS0000000633.json":[6194,6194],"./QUS0000000636.json":[70354,354],"./QUS0000000640.json":[53431,3431],"./QUS0000000641.json":[20692,692],"./QUS0000000657.json":[26514,6514],"./QUS0000000666.json":[14874,4874],"./QUS0000000668.json":[24209,4209],"./QUS0000000669.json":[99361,9361],"./QUS0000000676.json":[53918,3918],"./QUS0000000679.json":[8212,8212],"./QUS0000000682.json":[10200,200],"./QUS0000000690.json":[57090,7090],"./QUS0000000691.json":[11550,1550],"./QUS0000000692.json":[21986,1986],"./QUS0000000706.json":[13325,3325],"./QUS0000000712.json":[19851,9851],"./QUS0000000735.json":[10358,358],"./QUS0000000746.json":[72072,2072],"./QUS0000000747.json":[32111,2111],"./QUS0000000748.json":[29727,9727]};function i(e){if(!n.o(o,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=o[e],i=t[0];return n.e(t[1]).then(function(){return n.t(i,19)})}i.keys=function(){return Object.keys(o)},i.id=44415,e.exports=i},1090:function(e,t,n){Promise.resolve().then(n.bind(n,4644))},4644:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var o=n(57437),i=n(2265),s=n(63090);let a=[{text:"Do you understand everything so far?",audioPath:e=>"assets/clinic/common-AN-".concat(e,".mp3")},{text:"If you're still unsure, try reading the problem again.",audioPath:e=>"assets/clinic/common-random_1-".concat(e,".mp3")},{text:"Then, read the problem again and check the given conditions.",audioPath:e=>"assets/clinic/common-random_2-".concat(e,".mp3")},{text:"Let’s read again to see what the question is asking.",audioPath:e=>"assets/clinic/common-random_3-".concat(e,".mp3")},{text:"Shall we go over the key information in the problem again?",audioPath:e=>"assets/clinic/common-random_4-".concat(e,".mp3")},{text:"Look at the problem once more and check if you missed anything.",audioPath:e=>"assets/clinic/common-random_5-".concat(e,".mp3")},{text:"To better understand the problem, review the key terms again.",audioPath:e=>"assets/clinic/common-random_6-".concat(e,".mp3")},{text:"Think about how the information above might be used in the next question.",audioPath:e=>"assets/clinic/common-random_7-".concat(e,".mp3")},{text:"Now, let’s look at the next question and review each part of the problem again.",audioPath:e=>"assets/clinic/common-random_8-".concat(e,".mp3")},{text:"Try reading the problem more slowly and think about it again.",audioPath:e=>"assets/clinic/common-random_9-".concat(e,".mp3")},{text:"Then, read the problem slowly again and think about the main point one more time.",audioPath:e=>"assets/clinic/common-random_10-".concat(e,".mp3")},{text:"Which part are you unsure about?",audioPath:e=>"assets/clinic/common-ST-".concat(e,".mp3")},{text:"Is there anything that you're unsure about?",audioPath:e=>"assets/clinic/common-group-".concat(e,".mp3")},{text:"then take a look at this",audioPath:e=>"assets/clinic/common-keyword-".concat(e,".mp3")},{text:"this vidoe should help you understand better",audioPath:e=>"assets/clinic/common-video-".concat(e,".mp3")},{text:"I’m sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",audioPath:e=>"assets/clinic/common-zilmun-".concat(e,".mp3")},{text:"Sorry, I didn’t fully understand. Could you clarify a bit more, or should I start from the beginning?",audioPath:e=>"assets/clinic/common-sorry-".concat(e,".mp3")}],l=(e,t)=>{if(!t)return null;let n=a.find(t=>t.text===e);return n?n.audioPath(t):null},r=()=>{let[e,t]=(0,i.useState)([]),[n,o]=(0,i.useState)(!1),[a,r]=(0,i.useState)(!1),c=e=>{s.k.info("[addMessage] message",e),t(t=>[...t,e])};return{messages:e,isStreaming:n,streamText:async e=>{let{isOnlyText:t,text:n,message:i,teacherCode:a,hasChoiceButtons:r,clipSet:d,isMiddleQuestion:u=!1}=e;if(o(!0),s.k.info("streamText:",t,n,i,a,r,d,u),t){let e={text:n,sender:"bot",timestamp:new Date().toLocaleTimeString(),hasChoiceButtons:r,clip_set:d||null,audio:l(n,a),highlight_set:(null==i?void 0:i.highlight_set)||null,isMiddleQuestion:u};c(e),s.k.info("[streamText] newMessage",e)}else if(i){var h;let e=i.variations.filter(e=>e.teacher_code===a);if(!e.length){s.k.info("No matching variations found for teacher_code:",a),o(!1),c({text:i.content,sender:"bot",timestamp:new Date().toLocaleTimeString(),audio:null,hasChoiceButtons:r,clip_set:null,highlight_set:null,isMiddleQuestion:u});return}let t=e[Math.floor(Math.random()*e.length)];c({text:null!==(h=null==t?void 0:t.variation_content)&&void 0!==h?h:i.content,sender:"bot",timestamp:new Date().toLocaleTimeString(),audio:(null==t?void 0:t.tts)?"/".concat(t.tts):null,hasChoiceButtons:r,clip_set:d||null,highlight_set:(null==i?void 0:i.highlight_set)||null,isMiddleQuestion:u})}o(!1)},addMessage:c}};var c=n(66648),d=n(48388),u=function(e,t,n){for(var o=n,i=0,s=e.length;o<t.length;){var a=t[o];if(i<=0&&t.slice(o,o+s)===e)return o;"\\"===a?o++:"{"===a?i++:"}"===a&&i--,o++}return -1},h=/^\\begin{/,g=function(e,t){for(var n,o=[],i=RegExp("("+t.map(e=>e.left.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")).join("|")+")");-1!==(n=e.search(i));){n>0&&(o.push({type:"text",data:e.slice(0,n)}),e=e.slice(n));var s=t.findIndex(t=>e.startsWith(t.left));if(-1===(n=u(t[s].right,e,t[s].left.length)))break;var a=e.slice(0,n+t[s].right.length),l=h.test(a)?a:e.slice(t[s].left.length,n);o.push({type:"math",data:l,rawData:a,display:t[s].display}),e=e.slice(n+t[s].right.length)}return""!==e&&o.push({type:"text",data:e}),o},f=function(e,t){var n=g(e,t.delimiters);if(1===n.length&&"text"===n[0].type)return null;for(var o=document.createDocumentFragment(),i=0;i<n.length;i++)if("text"===n[i].type)o.appendChild(document.createTextNode(n[i].data));else{var s=document.createElement("span"),a=n[i].data;t.displayMode=n[i].display;try{t.preProcess&&(a=t.preProcess(a)),d.Z.render(a,s,t)}catch(e){if(!(e instanceof d.Z.ParseError))throw e;t.errorCallback("KaTeX auto-render: Failed to parse `"+n[i].data+"` with ",e),o.appendChild(document.createTextNode(n[i].rawData));continue}o.appendChild(s)}return o},p=function e(t,n){for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];if(3===i.nodeType){for(var s=i.textContent,a=i.nextSibling,l=0;a&&a.nodeType===Node.TEXT_NODE;)s+=a.textContent,a=a.nextSibling,l++;var r=f(s,n);if(r){for(var c=0;c<l;c++)i.nextSibling.remove();o+=r.childNodes.length-1,t.replaceChild(r,i)}else o+=l}else 1===i.nodeType&&function(){var t=" "+i.className+" ";-1===n.ignoredTags.indexOf(i.nodeName.toLowerCase())&&n.ignoredClasses.every(e=>-1===t.indexOf(" "+e+" "))&&e(i,n)}()}},C=function(e,t){if(!e)throw Error("No element provided to render");var n={};for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);n.delimiters=n.delimiters||[{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\begin{CD}",right:"\\end{CD}",display:!0},{left:"\\[",right:"\\]",display:!0}],n.ignoredTags=n.ignoredTags||["script","noscript","style","textarea","pre","code","option"],n.ignoredClasses=n.ignoredClasses||[],n.errorCallback=n.errorCallback||console.error,n.macros=n.macros||{},p(e,n)};n(7395);let m=e=>e,x=e=>{let{content:t,className:n,style:s,useProcessor:a=!1}=e,l=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(l.current){let e=a?m(t):t;l.current.innerHTML=e,a||C(l.current,{delimiters:[{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"$$",right:"$$",display:!0}],throwOnError:!1,macros:{"\\frac":"\\dfrac"}})}},[t,a]),(0,o.jsx)("div",{ref:l,className:n,style:s})};var y=n(37440),S=n(56106);let D=e=>{let{messages:t,children:n,onShowNext:a,onMessageComplete:l}=e,r=(0,i.useRef)([]),[d,u]=(0,i.useState)([]),[h,g]=(0,i.useState)(null),f=(0,i.useRef)(null),p=(0,i.useCallback)((e,t)=>{r.current[t]=e},[]);(0,i.useEffect)(()=>{t.length>0&&!d.includes(0)&&u([0])},[t]),(0,i.useEffect)(()=>{if(t.length>0){let e=t.length-1,n=t[e];if(s.k.info("[MessageList] Processing message:",{lastMessageIndex:e,lastMessage:n,visibleMessages:d}),n.isMiddleQuestion&&null!==h){let e=r.current[h];e&&(e.pause(),e.currentTime=0,g(null))}if(!d.includes(e)&&k(e,n)&&(u(t=>[...t,e].sort((e,t)=>e-t)),n.highlight_set&&n.highlight_set.length>0&&(s.k.info("from message - highlight_set",n.highlight_set),(0,y.dz)(S.Q.CTOF_CLINIC_HIGHTLIGHT,{highlight_set:n.highlight_set})),n.audio)){if(null!==h){let e=r.current[h];e&&(e.pause(),e.currentTime=0)}g(e),setTimeout(()=>{let t=r.current[e];t&&t.play().catch(e=>{s.k.info("[MessageList] Audio playback failed:",e),g(null)})},100)}setTimeout(()=>{C()},100)}},[t,h]);let C=()=>{var e;let t=null===(e=f.current)||void 0===e?void 0:e.closest(".overflow-y-auto");if(t){let e=t.scrollHeight-t.scrollTop===t.clientHeight;if(t.scrollTo({top:t.scrollHeight,behavior:"smooth"}),e){let e=document.querySelector(".clinic-chat-container");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}}},m=(0,i.useCallback)(e=>{if(s.k.info("[showNextMessage] Start",{currentIndex:e,currentPlayingIndex:h,messagesLength:t.length,visibleMessages:d}),null!==h){let e=r.current[h];e&&(s.k.info("[showNextMessage] Stopping current audio",h),e.pause(),e.currentTime=0)}let n=e+1;s.k.info("[showNextMessage] Calculating next index",{nextIndex:n,hasNextMessage:n<t.length,nextMessage:n<t.length?t[n]:null}),n<t.length&&(s.k.info("[showNextMessage] Setting visible messages",{currentVisible:d,willAdd:n}),u(e=>{let t=Array.from(new Set([...e,n])).sort((e,t)=>e-t);return s.k.info("[showNextMessage] New visible messages state:",t),t}),setTimeout(()=>{C()},100))},[h,t.length,t,d]),D=e=>{let t=r.current[e];t&&(t.play().catch(e=>{s.k.info("Audio playback failed:",e)}),g(e))};(0,i.useEffect)(()=>{a&&a(m)},[a,m]);let T=e=>{if(l&&l(e),m&&m(e),null!==h){let e=r.current[h];e&&(e.pause(),e.currentTime=0)}let n=e+1;n<t.length&&t[n].audio?(g(n),setTimeout(()=>{let e=r.current[n];e&&e.play().catch(e=>{s.k.info("[MessageList] Next audio playback failed:",e),g(null)})},100)):g(null)},N=e=>{s.k.info("Selected lecture code:",e),(0,y.dz)(S.Q.WTOF_CHAT_VIDEO_CLICK,e)};(0,i.useEffect)(()=>{var e;t.length>0&&0===d.length&&(null===(e=t[0])||void 0===e?void 0:e.audio)&&r.current[0]&&(r.current[0].play().catch(e=>{s.k.info("[MessageList] Auto-play failed:",e)}),g(0))},[t,d.length]),(0,i.useEffect)(()=>{let e=d[d.length-1];if(void 0!==e){let n=t[e];(null==n?void 0:n.sender)==="bot"&&n.highlight_set&&n.highlight_set.length>0&&(s.k.info("from message - highlight_set",n.highlight_set),(0,y.dz)(S.Q.CTOF_CLINIC_HIGHTLIGHT,{highlight_set:n.highlight_set}))}},[d,t]);let E=e=>"The clinic has ended. Now, try solving the problem again."===e,k=(e,n)=>!!(0===e||"user"===n.sender||n.isMiddleQuestion||e>0&&"user"===t[e-1].sender||e>0&&d.includes(e-1)&&!d.includes(e)&&"bot"===n.sender&&(!t[e-1].audio||h!==e-1));return(0,o.jsx)("div",{className:"bg-white rounded-lg h-[calc(100%-60px)] flex flex-col",onClick:e=>{if(!e.target.closest('[data-no-skip="true"]')&&null!==h){T(h);let e=h+1;e<t.length&&t[e].audio&&D(e)}},children:(0,o.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,o.jsxs)("div",{className:"p-4",children:[t.map((e,i)=>(0,o.jsxs)("div",{className:"flex flex-col ".concat("user"===e.sender?"justify-end":"justify-start"," mt-[10px] mb-[12px]"),style:{opacity:d.includes(i)?1:0,transition:"opacity 0.3s ease-in-out",height:d.includes(i)?"auto":0,overflow:"hidden"},children:[(0,o.jsx)("div",{className:"flex items-center ".concat("user"===e.sender?"justify-end":""),children:(0,o.jsxs)("div",{className:"pl-[16px] py-[10px] rounded-[8px] ".concat("user"===e.sender?"bg-[#F3F3F3] max-w-[85%] px-[16px]":E(e.text)?"bg-[#EDF5FF] w-full mt-4":e.clip_set?"w-full":"max-w-[85%]"),children:[(0,o.jsx)(x,{content:e.text,className:"".concat(E(e.text)?"text-[#1B64DA]":"text-gray-800")}),e.clip_set&&(0,o.jsx)("div",{"data-no-skip":"true",className:"overflow-x-auto w-full",children:(0,o.jsx)("div",{className:"inline-flex gap-4 pb-4",children:e.clip_set.map((e,t)=>(0,o.jsxs)("div",{className:"flex-shrink-0",children:[(0,o.jsx)("div",{className:"flex flex-row gap-4",children:e.lecture_vod_set.map((t,n)=>t.thumbnail_url&&(0,o.jsxs)("div",{className:"cursor-pointer hover:opacity-80 transition-opacity relative w-[280px]",onClick:()=>N(e.code),children:[(0,o.jsx)(c.default,{src:"/".concat(t.thumbnail_url),alt:"".concat(t.title," thumbnail"),className:"w-full h-auto rounded-lg",width:280,height:180}),(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 rounded-lg",children:(0,o.jsx)(c.default,{src:"/assets/images/icon_play.svg",alt:"play",className:"w-8 h-8",width:32,height:32})})]},n))}),(0,o.jsx)("h3",{className:"font-bold text-black mb-2 mt-2",children:e.title})]},t))})}),(0,o.jsx)("div",{className:"flex flex-row w-full",children:(0,o.jsx)("div",{className:"w-full",style:{display:"none"},children:e.audio&&(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsxs)("audio",{ref:e=>p(e,i),controls:!0,className:"w-full max-w-[300px]",onEnded:()=>{T(i)},children:[(0,o.jsx)("source",{src:e.audio,type:"audio/mp3"}),"Your browser does not support the audio element."]})})})})]})}),"bot"===e.sender&&i===t.length-1&&d.includes(i)&&e.hasChoiceButtons&&n]},i)),(0,o.jsx)("div",{ref:f})]})})})},T=e=>{let{nodes:t,deResponseType:n,setChangeClinicType:i,setClinicDEData:a,streamText:l,addMessage:r,currentBNodeIndex:c,setCurrentBNodeIndex:d,structuredBNodes:u,currentGroupIndex:h,setCurrentGroupIndex:g,currentQuestion:f}=e,p=async(e,t,n)=>{switch(s.k.info("\uD83D\uDCF1 [handleUserResponse] Start from DEBNodeButtons:",{type:e,nodeCode:null==t?void 0:t.code,index:n}),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e){case"CLICK":if(!t||void 0===n)return;await C(t,n);break;case"YES":await m(!0);break;case"NO":await m(!1)}},C=async(e,t)=>{console.log("=== DEBNodeButtons handleClick ==="),console.log("Selected B Node:",e),console.log("Selected Index:",t),console.log("Current structuredBNodes:",u),s.k.info("\uD83D\uDCF1 [handleClick] Calling Flutter handler from DEBNodeButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),r({text:e.shortcut_content||"",sender:"user",timestamp:new Date().toLocaleTimeString()}),i(!1);try{let e=u[t];if(console.log("Selected Node with Children:",e),e.children){let n=Object.keys(e.children)[0];console.log("First Group Name:",n);let o=e.children[n];if(console.log("First Group Messages:",o),o.length>0){a(o),d(t);for(let e=0;e<o.length;e++)s.k.info("Streaming message ".concat(e,":"),o[e]),await l({isOnlyText:!1,text:"",message:o[e],teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await l({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),console.log("Setting States - currentBNodeIndex:",t),i(!0),g(h+1)}}}catch(e){console.error("Failed to get next DE data:",e)}},m=async e=>{if(s.k.info("\uD83D\uDCF1 [handleUnderstandResponse] Calling Flutter handler from DEBNodeButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),r({text:e?"Yes, I know.":"No, I don't know.",sender:"user",timestamp:new Date().toLocaleTimeString()}),e){let e=u[c+1];if(s.k.info("✅ [handleUnderstandResponse] Yes path - Current Node:",{currentNode:e,currentBNodeIndex:c+1}),void 0===e){s.k.info("⚠️ [handleUnderstandResponse] Conversation ended - no more nodes"),await l({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});return}if(!e.isVariationsShown){for(let t of(s.k.info("\uD83D\uDD04 [handleUnderstandResponse] Showing variations first time:",{nodeCode:e.code,variations:e.variations,teacherCode:f.teacherCode}),a([e]),[e]))s.k.info("\uD83D\uDCE4 [handleUnderstandResponse] Streaming variation message:",{messageCode:t.code,content:t.content,teacherCode:f.teacherCode}),await l({isOnlyText:!1,text:"",message:t,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});s.k.info("✏️ [handleUnderstandResponse] Marking variations as shown"),u[c+1]={...e,isVariationsShown:!0},d(c+1)}}else try{s.k.info("❌ [handleUnderstandResponse] No path start");let e=u[c];if(s.k.info("\uD83D\uDCCB [handleUnderstandResponse] Current Node:",{nodeCode:e.code,hasChildren:!!e.children,childrenGroups:e.children?Object.keys(e.children):[]}),e.children){let t=Object.keys(e.children)[0],n=e.children[t];for(let e of(s.k.info("\uD83D\uDD0D [handleUnderstandResponse] First group details:",{groupName:t,messageCount:n.length,teacherCode:f.teacherCode}),n))s.k.info("\uD83D\uDCE4 [handleUnderstandResponse] Streaming C-type message:",{messageCode:e.code,content:e.content}),await l({isOnlyText:!1,text:"",message:e,teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await l({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),s.k.info("\uD83D\uDD04 [handleUnderstandResponse] Switching to C-type mode"),a(n),i(!0),g(1)}}catch(e){s.k.error("❌ [handleUnderstandResponse] Error:",e)}s.k.info("\uD83D\uDCF1 [handleUnderstandResponse] Calling Flutter handler:",{eventType:e})};return(0,o.jsx)("div",{className:"flex flex-col gap-2",children:n?(0,o.jsx)(o.Fragment,{children:t.map((e,t)=>(0,o.jsxs)("button",{onClick:()=>p("CLICK",e,t),className:"min-w-[100px] bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 text-sm rounded-[8px] text-left",children:[t+1,".",(0,o.jsx)(x,{content:e.shortcut_content||"",className:"text-gray-800"})]},e.code))}):(0,o.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,o.jsx)("button",{onClick:()=>p("YES"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"Yes, I know."}),(0,o.jsx)("button",{onClick:()=>p("NO"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"No, I don't know."})]})})},N=e=>{let{nodes:t,setChangeClinicType:n,setDeResponseType:i,streamText:a,addMessage:l,setClinicDEData:r,currentBNodeIndex:c,setCurrentBNodeIndex:d,structuredBNodes:u,currentGroupIndex:h,setCurrentGroupIndex:g,currentQuestion:f}=e,p=e=>e?e.replace(/<img[^>]*>/g,"").replace(/<br\s*\/?>/g,"").replace(/<p>\s*<\/p>/g,""):"",C=async e=>{if(s.k.info("\uD83D\uDCF1 [handleClick] Calling Flutter handler from DECNodeButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),l({text:p(e.content||""),sender:"user",timestamp:new Date().toLocaleTimeString()}),e.keyword_set){console.log("handleClick - keyword_set",e);try{for(let t of(await a({isOnlyText:!0,text:"then take a look at this",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),e.keyword_set))t?(await a({isOnlyText:!0,text:t.content,message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),r([{code:t.code,depth:"keyword",children:null,isVariationsShown:!1,highlight_set:[],keyword_set:[],option_set:[],variations:[],shortcut_content:null,option_type:"",order:0,group_name:null,clinic_type:"DE",type_index:0,parent:null,tag_set:[],content:t.content,clip_set:e.clip_set}]),n(!0)):await a({isOnlyText:!0,text:"키워드 데이터를 찾을 수 없어요.",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1})}catch(e){console.error("Failed to get keyword data:",e)}}},m=async()=>{try{console.log("=== DECNodeButtons handleContinue ==="),console.log("Current BNode Index:",c),console.log("Current Group Index:",h),s.k.info("\uD83D\uDCF1 [handleContinue] Calling Flutter handler from DECNodeButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),l({text:"Continue",sender:"user",timestamp:new Date().toLocaleTimeString()});let e=u[c];if(e.children){let t=Object.keys(e.children);s.k.info("Group Names:",t);let o=t[h];if(s.k.info("Next Group Name:",o),o){let t=e.children[o];for(let e of t)s.k.info("Streaming message:",e),await a({isOnlyText:!1,text:"",message:e,teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await a({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),r(t),n(!0),g(h+1)}else if(c+1<u.length){let e=u[c+1];s.k.info("Streaming next node:",e),await a({isOnlyText:!1,text:"",message:e,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),i(!1),r([e]),n(!0),d(c+1),g(0)}else await a({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),r([]),n(!0)}}catch(e){console.error("Failed to get next DE data:",e)}};return(0,o.jsxs)("div",{className:"flex flex-col gap-2",children:[t.map(e=>(0,o.jsx)("button",{onClick:()=>C(e),className:"min-w-[100px] bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 text-sm rounded-[8px] text-left",children:(0,o.jsx)(x,{content:p(e.content||""),className:"text-gray-800"})},e.code)),(0,o.jsx)("div",{className:"flex justify-start",children:(0,o.jsx)("button",{onClick:m,className:"bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 items-center text-sm rounded-[8px] text-left",children:"Continue"})})]})},E=e=>{let{onUserResponse:t,showNextButton:n,currentQuestion:i}=e,a=async e=>{switch(s.k.info("\uD83D\uDCF1 [handleUserResponse] Start:",{type:e}),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e){case"YES":case"NEXT":t("AN",!0);break;case"NO":t("AN",!1)}};return(0,o.jsx)("div",{className:"flex gap-4",children:n?(0,o.jsx)("button",{onClick:()=>a("NEXT"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-[8px]",children:"Next"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:()=>a("YES"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-[8px]",children:"Yes"}),(0,o.jsx)("button",{onClick:()=>a("NO"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-[8px]",children:"No"})]})})},k=e=>{let{getClinicData:t,currentQuestion:n,onUserResponse:i}=e,a=async()=>{s.k.info("\uD83D\uDCF1 [handleStartSolving] Calling Flutter handler from STClinicButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),i("ST",!0,"Yes, I was working on it")},l=async()=>{s.k.info("\uD83D\uDCF1 [handleNotStarted] Calling Flutter handler from STClinicButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),i("ST",!1,"I don’t know how to start")};return(0,o.jsxs)("div",{className:"flex gap-4",children:[(0,o.jsx)("button",{onClick:a,className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"Yes, I was working on it"}),(0,o.jsx)("button",{onClick:l,className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"I don’t know how to start"})]})},_=["If you're still unsure, try reading the problem again.","Then, read the problem again and check the given conditions.","Let’s read again to see what the question is asking.","Shall we go over the key information in the problem again?","Look at the problem once more and check if you missed anything.","To better understand the problem, review the key terms again.","Think about how the information above might be used in the next question.","Now, let’s look at the next question and review each part of the problem again.","Try reading the problem more slowly and think about it again.","Then, read the problem slowly again and think about the main point one more time."],w=e=>{let{currentKeywordCode:t,setChangeClinicType:n,streamText:i,addMessage:a,onContinue:l,setClinicDEData:r,nodes:c,currentQuestion:d}=e,u=async e=>{if(a({text:e?"I understand.":"I’m not quite sure.",sender:"user",timestamp:new Date().toLocaleTimeString()}),s.k.info("\uD83D\uDCF1 [handleUnderstand] Calling Flutter handler from DEKeywordNodeButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e)l();else try{await i({isOnlyText:!0,text:"this vidoe should help you understand better",message:null,teacherCode:d.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),await i({isOnlyText:!0,text:"",message:null,teacherCode:d.teacherCode,hasChoiceButtons:!0,clipSet:c[0].clip_set,isMiddleQuestion:!1}),r([{depth:"clip",code:t,children:null,isVariationsShown:!1,highlight_set:[],keyword_set:[],option_set:[],variations:[],shortcut_content:null,option_type:"",order:0,group_name:null,clinic_type:"DE",type_index:0,parent:null,tag_set:[],content:"",clip_set:c[0].clip_set}]),n(!0)}catch(e){console.error("Failed to get additional keyword data:",e)}};return(0,o.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,o.jsx)("button",{onClick:()=>u(!0),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"I understand."}),(0,o.jsx)("button",{onClick:()=>u(!1),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"I’m not quite sure."})]})},I=e=>{let{currentKeywordCode:t,setChangeClinicType:n,setDeResponseType:i,streamText:a,addMessage:l,setClinicDEData:r,nodes:c,onContinue:d,currentQuestion:u}=e;return(0,o.jsx)("div",{className:"flex flex-row gap-2",children:(0,o.jsx)("button",{onClick:()=>{s.k.info("\uD83D\uDCF1 [handleUnderstand] Calling Flutter handler from DEClipNodeButtons"),(0,y.dz)(S.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),l({text:"Continue",sender:"user",timestamp:new Date().toLocaleTimeString()}),d()},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"Continue"})})},v=e=>{var t,n,a,l;let{messages:r,showNextMessage:c,clinicType:d,changeClinicType:u,deResponseType:h,setDeResponseType:g,currentBNodeIndex:f,setCurrentBNodeIndex:p,structuredBNodes:C,setStructuredBNodes:m,currentGroupIndex:x,setCurrentGroupIndex:y,addMessage:S,streamText:D,setClinicType:v,setChangeClinicType:Q,setClinicData:b,showNextButton:j,setShowNextButton:U,middleQuestionStatus:O,initialize:F,getClinicData:L,currentQuestion:R,setQuestionInfo:A,...B}=e;(0,i.useEffect)(()=>{u||(g(!1),U(!1))},[u,g,U]),(0,i.useEffect)(()=>{s.k.info("[ClinicTypeChangeButtons] Props changed:",{clinicType:d,changeClinicType:u,messagesLength:r.length,hasShowNextMessage:!!c})},[d,u,r,c]);let M=async(e,t,n)=>{if(s.k.info("[handleUserResponse] Start",{clinicType:e,isYes:t,customText:n}),S({text:n||(t?"Yes":"No"),sender:"user",timestamp:new Date().toLocaleTimeString()}),await new Promise(e=>setTimeout(e,50)),"AN"===e){if(t)try{s.k.info("[handleUserResponse] Loading data for ST",R.code,R.teacherCode);let e=await L("ST",R.code);if(s.k.info("[handleUserResponse] ST data received:",e),!e||0===e.length){s.k.info("[handleUserResponse] No ST data available");return}let t=e.filter((t,n)=>e.findIndex(e=>e.content===t.content)===n);for(let e of(b(t),t)){var o;s.k.info("[handleUserResponse] About to stream message",{code:e.code,content:e.content,variations:null===(o=e.variations)||void 0===o?void 0:o.length}),await D({isOnlyText:!1,text:"",message:e,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),s.k.info("[handleUserResponse] Message streamed successfully")}s.k.info("[handleUserResponse] Before setting ST type"),v("ST"),Q(!0),s.k.info("[handleUserResponse] After setting ST type")}catch(e){s.k.info("[handleUserResponse] Error:",e)}else{let e=_[Math.floor(Math.random()*_.length)];await D({isOnlyText:!0,text:e,message:null,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),U(!0)}}else if("ST"===e){if(s.k.info("[handleUserResponse] Handling ST response",{isYes:t}),s.k.info("[handleUserResponse] ST clinic type"),t){await D({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await L("DE",R.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),s.k.info("structuredBNodes",t),B.setClinicDEData(t),m(t),v("DE"),Q(!0),g(!0)}catch(e){s.k.info("[handleUserResponse] Error loading DE data:",e)}}else try{let e=await L("DE",R.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),s.k.info("structuredBNodes",t),B.setClinicDEData(t),m(t),v("DE"),Q(!0),g(!1);let o=t[f];if(s.k.info("Current Node:",o),!o.isVariationsShown){for(let e of(s.k.info("Showing Node Variations First Time"),s.k.info("Node to show:",o),B.setClinicDEData([o]),[o]))s.k.info("Streaming Node Message:",e),await D({isOnlyText:!1,text:"",message:e,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});s.k.info("Marking variations as shown"),t[f]={...o,isVariationsShown:!0};return}}catch(e){console.error("Failed to get DE clinic data:",e)}}};return(0,o.jsxs)("div",{className:"px-[16px] pb-[8px]",children:["AN"===d&&(0,o.jsx)("div",{children:(0,o.jsx)(E,{onUserResponse:M,showNextButton:j,currentQuestion:R})}),"ST"===d&&(0,o.jsx)("div",{children:(0,o.jsx)(k,{...B,getClinicData:L,currentQuestion:R,addMessage:S,setClinicType:v,setChangeClinicType:Q,streamText:D,onUserResponse:M,deResponseType:h,setDeResponseType:g,structuredBNodes:C,setStructuredBNodes:m})}),"DE"===d&&(0,o.jsxs)(o.Fragment,{children:[(null===(t=B.clinicDEData[0])||void 0===t?void 0:t.depth)==="B"&&(0,o.jsx)(T,{currentQuestion:R,deResponseType:h,nodes:B.clinicDEData,setChangeClinicType:Q,setClinicDEData:B.setClinicDEData,streamText:D,addMessage:S,currentBNodeIndex:f,setCurrentBNodeIndex:p,structuredBNodes:C,currentGroupIndex:x,setCurrentGroupIndex:y}),(null===(n=B.clinicDEData[0])||void 0===n?void 0:n.depth)==="C"&&(0,o.jsx)(N,{currentQuestion:R,structuredBNodes:C,nodes:B.clinicDEData,currentBNodeIndex:f,setCurrentBNodeIndex:p,setChangeClinicType:Q,streamText:D,addMessage:S,setClinicDEData:B.setClinicDEData,setDeResponseType:g,currentGroupIndex:x,setCurrentGroupIndex:y}),(null===(a=B.clinicDEData[0])||void 0===a?void 0:a.depth)==="keyword"&&(0,o.jsx)(w,{currentQuestion:R,currentKeywordCode:B.clinicDEData[0].code,setChangeClinicType:Q,setDeResponseType:g,streamText:D,addMessage:S,setClinicDEData:B.setClinicDEData,nodes:B.clinicDEData,onContinue:async()=>{let e=f+1;if(e>=C.length){s.k.warn("No more nodes available:",{currentIndex:f,totalNodes:C.length}),await D({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});return}let t=C[e];if(s.k.info("Selected Node with Children:",t),null==t?void 0:t.children){let e=Object.keys(t.children)[0];s.k.info("First Group Name:",e);let n=t.children[e];for(let e of(s.k.info("First Group Messages:",n),n))s.k.info("Streaming Message:",e),await D({isOnlyText:!1,text:"",message:e,teacherCode:R.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await D({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),s.k.info("Setting States - currentBNodeIndex:",1),Q(!0),B.setClinicDEData(n),p(f+1)}}}),(null===(l=B.clinicDEData[0])||void 0===l?void 0:l.depth)==="clip"&&(0,o.jsx)(I,{currentQuestion:R,currentKeywordCode:B.clinicDEData[0].code,setChangeClinicType:Q,setDeResponseType:g,streamText:D,addMessage:S,nodes:B.clinicDEData,setClinicDEData:B.setClinicDEData,onContinue:async()=>{let e=f+1;if(e>=C.length){s.k.warn("No more nodes available:",{currentIndex:f,totalNodes:C.length}),await D({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});return}let t=C[e];if(s.k.info("Selected Node with Children:",t),null==t?void 0:t.children){let e=Object.keys(t.children)[0];s.k.info("First Group Name:",e);let n=t.children[e];for(let e of(s.k.info("First Group Messages:",n),n))s.k.info("Streaming Message:",e),await D({isOnlyText:!1,text:"",message:e,teacherCode:R.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await D({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),s.k.info("Setting States - currentBNodeIndex:",1),Q(!0),B.setClinicDEData(n),p(f+1)}}})]}),"MQ"===d&&(0,o.jsx)("div",{className:"flex flex-row gap-2",children:"Notfound"===O?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:async()=>{v("AN"),Q(!0),await F()},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"From Beginning"}),(0,o.jsx)("button",{onClick:async()=>{await D({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await L("DE",R.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),s.k.info("structuredBNodes",t),B.setClinicDEData(t),m(t),v("DE"),Q(!0),g(!0)}catch(e){s.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"Continue Explanation"})]}):"Fail"===O?(0,o.jsx)("button",{onClick:async()=>{await D({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:R.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await L("DE",R.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),s.k.info("structuredBNodes",t),B.setClinicDEData(t),m(t),v("DE"),Q(!0),g(!0)}catch(e){s.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"Continue Explanation"}):null})]})};var Q=n(48034);let b=!1,j=()=>{let[e,t]=(0,i.useState)(!1),[o,a]=(0,i.useState)([]),[l,r]=(0,i.useState)([]),[c,d]=(0,i.useState)({code:"",teacherCode:"",clinicCode:null}),[u,h]=(0,i.useState)(null);(0,i.useEffect)(()=>{{if(!c.code||!c.teacherCode){s.k.warn("⚠️ [localStorage] Preventing empty save:",c);return}let e=localStorage.getItem("currentQuestion"),t=e?JSON.parse(e):null;if(t&&t.code===c.code&&t.teacherCode===c.teacherCode&&t.clinicCode===c.clinicCode)return;localStorage.setItem("currentQuestion",JSON.stringify(c)),s.k.info("\uD83D\uDD04 [localStorage] Updated:",c)}},[c]);let g=(0,i.useCallback)(()=>l.length>0,[l]),f=(0,i.useCallback)(async(e,t)=>{try{if(g())return s.k.info("\uD83D\uDD35 [loadOriginalData] Data already loaded:",{dataLength:l.length}),l;s.k.info("\uD83D\uDD35 [loadOriginalData] Loading new data for:",{questionCode:e,teacherCode:t});let o=await n(44415)("./".concat(e,".json"));if(!(null==o?void 0:o.default)||!Array.isArray(o.default))throw Error("Invalid data format for ".concat(e));let i=o.default;return r(i),a(i),s.k.info("\uD83D\uDD35 [loadOriginalData] New data loaded:",{length:i.length}),i}catch(e){throw s.k.error("❌ [loadOriginalData] Error:",e),e}},[l,g]),p=async(e,t)=>{try{s.k.info("\uD83D\uDD0D [getClinicData] Current state:",{currentQuestionCode:c.code,currentTeacherCode:c.teacherCode,requestedCode:t,type:e}),c.teacherCode||s.k.warn("⚠️ [getClinicData] teacherCode is empty!");let o=t||c.code,i=c.teacherCode;s.k.debug("getClinicData","Loading data for:",{type:e,code:o,teacherCode:i}),g()||await f(o,i);let a=await n(44415)("./".concat(o,".json"));if(!(null==a?void 0:a.default)||!Array.isArray(a.default))throw Error("Invalid data format for ".concat(o));let l=a.default,r=l.filter(t=>t.clinic_type===e);return s.k.debug("getClinicData","Filtered results:",{type:e,totalCount:l.length,filteredCount:r.length}),r}catch(e){return s.k.error("getClinicData","Error:",e),[]}},C=(0,i.useCallback)((e,t,n)=>{s.k.info("\uD83D\uDD0D [setQuestionInfo] Before update:",{prevState:c,newValues:{code:e,teacherCode:t,clinicCode:n}}),d(o=>{let i={code:e,teacherCode:void 0!==t?t:o.teacherCode,clinicCode:void 0===n?o.clinicCode:n};return s.k.info("\uD83D\uDD0D [setQuestionInfo] State updated:",{prevState:o,newState:i}),i})},[]);return(0,i.useRef)(!1),(0,i.useEffect)(()=>{},[]),(0,i.useEffect)(()=>{async function e(e){s.k.info("[eventHandler] Received event:",e);try{if(!e.detail){s.k.info("⚠️ [eventHandler] No event detail");return}let{type:n,data:o}=e.detail;if(s.k.info("\uD83D\uDD35 [eventHandler] Processing event:",{type:n,data:o}),n===S.Q.FTOW_CLINICK){b||(localStorage.removeItem("currentQuestion"),s.k.info("\uD83D\uDD04 [eventHandler] Initial localStorage clear"),b=!0);let e="string"==typeof o?o:o.questionCode,n="string"==typeof o?c.teacherCode:o.teacherCode,i="string"==typeof o?null:o.clinicCode;s.k.info("\uD83D\uDD35 [eventHandler] Loading data for:",{questionCode:e,teacherCode:n,clinicCode:i}),e&&(t(!0),await f(e,n),C(e,n,i),t(!1))}else if(n===S.Q.FTOW_CLINIC_START_MIDLE_QUESTION){if(s.k.info("\uD83D\uDD35 [eventHandler] Middle question start"),o&&"object"==typeof o){let{status:e,clinicCode:n}=o;s.k.info("\uD83D\uDD35 [eventHandler] Loading middle question data:",{status:e,clinicCode:n}),h(e);let i=localStorage.getItem("currentQuestion");if(i){let{code:e,teacherCode:o}=JSON.parse(i);s.k.info("\uD83D\uDD35 [eventHandler] Using saved question info:",{questionCode:e,teacherCode:o,clinicCode:n}),t(!0),C(e,o,n),t(!1)}else s.k.warn("⚠️ [eventHandler] No saved question info found in localStorage")}}else s.k.info("⚠️ [eventHandler] Unknown event type:",n)}catch(e){s.k.error("[eventHandler] Error:",e),t(!1)}}return window.addEventListener(S.Q.FTOW_EVENT_NAME,e),Q.d.onEvent(e=>{s.k.info("✅ [eventStore] Event received:",e);try{window.dispatchEvent(new CustomEvent(S.Q.FTOW_EVENT_NAME,{detail:{type:e.type,data:e.data}})),s.k.info("✅ [eventStore] Event dispatched successfully")}catch(e){s.k.info("❌ [eventStore] Failed to dispatch event:",e)}}),Q.d.setReady(),()=>{window.removeEventListener(S.Q.FTOW_EVENT_NAME,e),s.k.info("\uD83D\uDD35 [useEffect cleanup] Preserving originalData:",{exists:!!l,length:l.length})}},[]),{getClinicData:p,loading:e,clinicData:o,setClinicData:a,originalData:l,currentQuestion:c,setQuestionInfo:C,middleQuestionStatus:u}};var U=()=>{let[e,t]=(0,i.useState)("AI_TEACHER"),{messages:n,streamText:a,addMessage:l}=r(),{getClinicData:c,clinicData:d,setClinicData:u,originalData:h,currentQuestion:g,middleQuestionStatus:f,setQuestionInfo:p}=j(),[C,m]=(0,i.useState)([]),[x,y]=(0,i.useState)("AN"),S=(0,i.useRef)(!1),[T,N]=(0,i.useState)(!1),[E,k]=(0,i.useState)([]),[_,w]=(0,i.useState)(!1),[I,Q]=(0,i.useState)(0),[b,U]=(0,i.useState)(0),[O,F]=(0,i.useState)(!1),[L,R]=(0,i.useState)(null),A=(0,i.useCallback)(e=>{R(()=>e)},[]),B=async()=>{try{if(s.k.info("[initialize] currentQuestion:",{currentQuestion:g}),!g.code){s.k.info("[initialize] Waiting for question code");return}if(s.k.info("\uD83D\uDCCC [INITIALIZE] Initial state update:",{clinicType:"AN",changeClinicType:!0,messages:n.length,currentQuestion:g,middleQuestionStatus:f}),N(!0),g.clinicCode){s.k.info("\uD83D\uDCCC [INITIALIZE] Middle question starting:",{clinicCode:g.clinicCode,status:"Success"});let e=await c("DE",g.code);s.k.info("\uD83D\uDCCC [INITIALIZE] DE data loaded:",{totalCount:e.length,clinicCode:g.clinicCode});let t=[],o=null;e.forEach(e=>{if("B"===e.depth){let n={...e,children:{},isVariationsShown:!1};t.push(n),o=n}else if("C"===e.depth&&o){let t=e.group_name||"default";o.children[t]||(o.children[t]=[]),o.children[t].push(e)}}),s.k.info("\uD83D\uDCCC [INITIALIZE] Structured B nodes:",{totalBNodes:t.length,bNodeCodes:t.map(e=>e.code)});let i=t.findIndex(e=>e.code===g.clinicCode);if(s.k.info("\uD83D\uDCCC [INITIALIZE] Target node search result:",{targetNodeIndex:i,found:-1!==i,searchedCode:g.clinicCode}),-1!==i){let e=t[i];if(s.k.info("\uD83D\uDCCC [INITIALIZE] Updating states:",{clinicType:"DE",changeClinicType:!0,deResponseType:!0}),k(t),y("DE"),N(!0),w(!0),s.k.info("\uD83D\uDCCC [INITIALIZE] States updated:",{clinicType:"DE",changeClinicType:!0,messages:n.length,currentQuestion:g,middleQuestionStatus:f}),e.children){let t=Object.keys(e.children)[0],o=e.children[t];for(let e of(m(o),s.k.info("\uD83D\uDCCC [INITIALIZE] Before adding user message:",{messagesLength:n.length}),s.k.info("\uD83D\uDCCC [INITIALIZE] After adding user message:",{messagesLength:n.length}),o))s.k.info("[initialize] streamText",e),await a({isOnlyText:!1,text:"",message:e,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});await a({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),Q(i)}}}else{let e=await c("AN",g.code);s.k.info("[initialize] AN data loaded:",{data:e});let t=e.filter((t,n)=>e.findIndex(e=>e.content===t.content)===n);for(let e of(u(t),t))s.k.info("[initialize] streamText",e),await a({isOnlyText:!1,text:"",message:e,teacherCode:g.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await a({isOnlyText:!0,text:"Do you understand everything so far?",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1})}s.k.info("[initialize] Current state:",{clinicType:x,changeClinicType:!0,messages:n.length}),S.current=!0}catch(e){console.error("[initialize] Error:",e),N(!0)}};return(0,i.useEffect)(()=>{g.code&&B()},[g.code,g.clinicCode]),(0,i.useEffect)(()=>{(async()=>{s.k.info("[ClinicChatbotClient] State update:",{clinicType:x,changeClinicType:T,messages:n.length,currentQuestion:g,middleQuestionStatus:f}),g.code&&g.teacherCode&&("Success"===f?s.k.info("[ClinicChatbotClient] Middle question started successfully"):"Notfound"===f?(s.k.info("[ClinicChatbotClient] Middle question not found"),await a({isOnlyText:!0,text:"Sorry, I didn’t fully understand. Could you clarify a bit more, or should I start from the beginning?",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!0}),y("MQ"),N(!0)):"Fail"===f&&(s.k.info("[ClinicChatbotClient] Middle question failed"),await a({isOnlyText:!0,text:"I'm sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!0}),y("MQ"),N(!0)))})()},[f]),(0,o.jsxs)("div",{className:"clinic-chat-container mx-auto h-screen flex flex-col p-4 overflow-y-auto",children:[!1,(0,o.jsx)("div",{className:"flex-shrink-0 p-[16px] pt-[12px] border-b border-[#f5f5f5] justify-start",children:[{id:"AI_TEACHER",label:"AI Teacher"},{id:"NOTIFICATION",label:"Notification"},{id:"WRONG_ANSWER",label:"Incorrect Solutions"},{id:"WEAKNESS",label:"Weakness Analysis"}].map(t=>(0,o.jsx)("button",{onClick:()=>{},className:"border px-[18px] w-min py-[10px] rounded-[6px] font-medium text-[13px] text-center ".concat(e===t.id?"border-[#ebebeb] text-[#333]":"border-transparent text-[#767676]"),children:t.label},t.id))}),(0,o.jsx)("div",{className:"flex-1 min-h-0",children:(0,o.jsx)(D,{messages:n,onShowNext:A,children:(0,o.jsx)("div",{className:"w-full",children:(0,o.jsx)(v,{messages:n,showNextMessage:L,clinicType:x,changeClinicType:T,setChangeClinicType:N,deResponseType:_,setDeResponseType:w,clinicData:d,clinicDEData:C,currentBNodeIndex:I,setCurrentBNodeIndex:Q,setClinicData:u,setClinicDEData:m,structuredBNodes:E,setStructuredBNodes:k,setClinicType:y,streamText:a,addMessage:l,currentGroupIndex:b,setCurrentGroupIndex:U,showNextButton:O,setShowNextButton:F,middleQuestionStatus:f,initialize:B,getClinicData:c,currentQuestion:g,setQuestionInfo:p})})})})]})};function O(){return(0,i.useEffect)(()=>{window.learnScreenEventChannel=function(e,t){Q.d.addEvent({type:e,data:JSON.parse(JSON.stringify(t))})}},[]),(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)("div",{children:"Loading..."}),children:(0,o.jsx)(U,{})})}},63090:function(e,t,n){"use strict";function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];try{let t=n.map(e=>{if("object"==typeof e)try{return JSON.stringify(e,null,2)}catch(e){return"[Complex Object]"}return String(e)}).join(" ");console.log("".concat(e,": ").concat(t))}catch(e){console.error("Logger Error:",e)}}n.d(t,{k:function(){return i}});let i={info:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("ℹ️ [".concat(e,"]"),...n)},success:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("✅ [".concat(e,"]"),...n)},warn:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("⚠️ [".concat(e,"]"),...n)},error:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("❌ [".concat(e,"]"),...n)},debug:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("\uD83D\uDD35 [".concat(e,"]"),...n)}}},37440:function(e,t,n){"use strict";n.d(t,{cn:function(){return l},dz:function(){return c},l_:function(){return d},lr:function(){return h},q1:function(){return u}});var o=n(48388);n(7395);var i=n(44839),s=n(96164),a=n(27776);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,i.W)(t))}let r=()=>!!window.flutter_inappwebview,c=async function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(r())try{return JSON.parse(await window.flutter_inappwebview.callHandler(e,...n.map(e=>JSON.stringify(e))))}catch(e){throw console.error("Error calling Flutter handler:",e),e}return null},d=e=>{let t=document.createElement("img");return t.id="question-result-mark",t.src=e,t.className="question-is-correct-mark",t.style.width="60px",t.style.height="60px",t.style.margin="0px",t},u=e=>null!=e?e.replace(/\$\$(.*?)\$\$|\$(.*?)\$/g,(e,t,n)=>{let i=e.startsWith("$$");try{return o.Z.renderToString(t||n,{displayMode:i,throwOnError:!1,macros:{"\\frac":"\\dfrac"}})}catch(e){return console.error("LaTeX rendering error:",e),'<span style="color: red;">[LaTeX Error: '.concat(e instanceof Error?e.message:String(e),"]</span>")}}):e,h=()=>{(0,a.A)("Coming Soon",{duration:1500})}},66648:function(e,t,n){"use strict";n.d(t,{default:function(){return i.a}});var o=n(55601),i=n.n(o)},55601:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return r},getImageProps:function(){return l}});let o=n(99920),i=n(80497),s=n(38173),a=o._(n(21241));function l(e){let{props:t}=(0,i.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let r=s.Image},48034:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});var o=n(63090);class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}addEvent(e){o.k.info("[EventStore] Adding event:",e),this.isReady?this.callbacks.forEach(t=>t(e)):this.eventQueue.push(e)}setReady(){this.isReady=!0,this.processQueue()}onEvent(e){this.callbacks.push(e)}processQueue(){for(;this.eventQueue.length>0;){let e=this.eventQueue.shift();e&&this.callbacks.forEach(t=>t(e))}}constructor(){this.eventQueue=[],this.isReady=!1,this.callbacks=[]}}let s=i.getInstance()},56106:function(e,t,n){"use strict";var o,i;n.d(t,{Q:function(){return o}}),(i=o||(o={})).FTOW_EVENT_NAME="flutterEvent",i.FTOW_DRAW_QUESTION="DRAW_QUESTION",i.FTOW_SELECT_ANSWER="SELECT_ANSWER",i.FTOW_QUESTION_LIST="QUESTION_PREVIEW_LIST",i.FTOW_RESULT_LIST="RESULT_PREVIEW_LIST",i.FTOW_CHAT_INPUT="CHAT_INPUT",i.WTOF_GENERATE_BUTTONS="GENERATE_BUTTONS",i.WTOF_PAGE_HEIGHT="PAGE_HEIGHT",i.WTOF_HIGHLIGHT="HIGHLIGHT",i.FTOW_CLINIC_DATA="FTOW_CLINIC_DATA",i.FTOW_CLINIC_DE_DATA="FTOW_CLINIC_DE_DATA",i.WTOF_CLINIC_TYPE_CHANGE="CLINIC_TYPE_CHANGE",i.WTOF_REQUEST_DE_DATA="REQUEST_DE_DATA",i.WTOF_REQUEST_KEYWORD="REQUEST_KEYWORD",i.FTOW_KEYWORD_DATA="KEYWORD_DATA",i.FTOW_CLINICK="CILINIC_INIT",i.WTOF_CLINICK_HIGHLIGHT="CLINIC_HIGHLIGHT",i.FTOW_EXPLAIN="EXPLAIN",i.FTOW_DRAW_QUIZ="DRAW_QUIZ",i.FTOW_CHECK_QUIZ="CHECK_QUIZ",i.WTOF_RESULT_QUIZ="RESULT_QUIZ",i.WTOF_CHAT_VIDEO_CLICK="CHAT_VIDEO_CLICK",i.FTOW_TEACHER_ID="TEACHER_ID",i.CTOF_CLINIC_HIGHTLIGHT="CLINIC_HIGHLIGHT_FOR_FLUTTER",i.FTOW_QUIZ_ANSWER="QUIZ_INPUT",i.CTOF_CLINIC_EVENT_RESPOONSE="CLINIC_EVENT_RESPOONSE_FOR_FLUTTER",i.FTOW_CLINIC_START_MIDLE_QUESTION="CLINIC_START_MIDLE_QUESTION"}},function(e){e.O(0,[5864,3954,1351,4868,8173,2971,7023,1744],function(){return e(e.s=1090)}),_N_E=e.O()}]);
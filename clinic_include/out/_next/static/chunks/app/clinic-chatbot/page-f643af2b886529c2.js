(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1103],{44415:function(e,t,n){var o={"./QUS0000000324.json":[74522,4522],"./QUS0000000327.json":[811,811],"./QUS0000000328.json":[83869,3869],"./QUS0000000329.json":[4926,4926],"./QUS0000000330.json":[1197,1197],"./QUS0000000331.json":[21960,1960],"./QUS0000000332.json":[87037,7037],"./QUS0000000338.json":[89811,9811],"./QUS0000000339.json":[97068,7068],"./QUS0000000340.json":[94201,8209],"./QUS0000000341.json":[33850,3850],"./QUS0000000344.json":[84201,4201],"./QUS0000000345.json":[40869,869],"./QUS0000000346.json":[90766,766],"./QUS0000000347.json":[94204,4204],"./QUS0000000348.json":[21163,1163],"./QUS0000000349.json":[37697,7697],"./QUS0000000350.json":[88042,8042],"./QUS0000000351.json":[52160,2160],"./QUS0000000352.json":[9987,9987],"./QUS0000000353.json":[22765,2765],"./QUS0000000354.json":[49268,9268],"./QUS0000000355.json":[27864,7864],"./QUS0000000356.json":[7025,7025],"./QUS0000000383.json":[49434,9434],"./QUS0000000393.json":[65516,5516],"./QUS0000000395.json":[10652,652],"./QUS0000000396.json":[17738,7738],"./QUS0000000399.json":[10922,922],"./QUS0000000402.json":[42443,2443],"./QUS0000000403.json":[52105,2105],"./QUS0000000404.json":[49974,9974],"./QUS0000000412.json":[32086,2086],"./QUS0000000413.json":[25563,5563],"./QUS0000000414.json":[3370,3370],"./QUS0000000417.json":[44095,4095],"./QUS0000000419.json":[87247,7247],"./QUS0000000420.json":[28421,8421],"./QUS0000000423.json":[46095,6095],"./QUS0000000424.json":[33109,3109],"./QUS0000000425.json":[39854,9854],"./QUS0000000446.json":[29312,9312],"./QUS0000000447.json":[36837,6837],"./QUS0000000448.json":[55177,5177],"./QUS0000000450.json":[17503,7503],"./QUS0000000452.json":[32825,2825],"./QUS0000000453.json":[46615,6615],"./QUS0000000455.json":[61536,1536],"./QUS0000000456.json":[23532,3532],"./QUS0000000465.json":[18106,8106],"./QUS0000000466.json":[16684,6684],"./QUS0000000469.json":[75978,5978],"./QUS0000000470.json":[75186,5186],"./QUS0000000471.json":[33261,3261],"./QUS0000000473.json":[84190,4190],"./QUS0000000474.json":[44481,4481],"./QUS0000000475.json":[86351,6351],"./QUS0000000476.json":[63415,3415],"./QUS0000000478.json":[92548,2548],"./QUS0000000480.json":[93687,3687],"./QUS0000000481.json":[82273,2273],"./QUS0000000493.json":[25094,5094],"./QUS0000000498.json":[43910,3910],"./QUS0000000501.json":[53904,3904],"./QUS0000000504.json":[6313,6313],"./QUS0000000509.json":[6468,6468],"./QUS0000000510.json":[3297,3297],"./QUS0000000511.json":[43149,3149],"./QUS0000000525.json":[49502,9502],"./QUS0000000538.json":[61763,1763],"./QUS0000000540.json":[59677,9677],"./QUS0000000589.json":[5321,5321],"./QUS0000000590.json":[83767,3767],"./QUS0000000617.json":[74744,4744],"./QUS0000000631.json":[1601,1601],"./QUS0000000632.json":[28988,8988],"./QUS0000000633.json":[6194,6194],"./QUS0000000636.json":[70354,354],"./QUS0000000640.json":[53431,3431],"./QUS0000000641.json":[20692,692],"./QUS0000000657.json":[26514,6514],"./QUS0000000666.json":[14874,4874],"./QUS0000000668.json":[24209,4209],"./QUS0000000669.json":[99361,9361],"./QUS0000000676.json":[53918,3918],"./QUS0000000679.json":[8212,8212],"./QUS0000000682.json":[10200,200],"./QUS0000000690.json":[57090,7090],"./QUS0000000691.json":[11550,1550],"./QUS0000000692.json":[21986,1986],"./QUS0000000706.json":[13325,3325],"./QUS0000000712.json":[19851,9851],"./QUS0000000735.json":[10358,358],"./QUS0000000746.json":[72072,2072],"./QUS0000000747.json":[32111,2111],"./QUS0000000748.json":[29727,9727]};function i(e){if(!n.o(o,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=o[e],i=t[0];return n.e(t[1]).then(function(){return n.t(i,19)})}i.keys=function(){return Object.keys(o)},i.id=44415,e.exports=i},1090:function(e,t,n){Promise.resolve().then(n.bind(n,85475))},85475:function(e,t,n){"use strict";let o;n.r(t),n.d(t,{default:function(){return ei}});var i=n(57437),s=n(2265),a=n(63090);let r=[{text:"Do you understand everything so far?",audioPath:e=>"assets/clinic/common-AN-".concat(e,".mp3")},{text:"If you're still unsure, try reading the problem again.",audioPath:e=>"assets/clinic/common-random_1-".concat(e,".mp3")},{text:"Then, read the problem again and check the given conditions.",audioPath:e=>"assets/clinic/common-random_2-".concat(e,".mp3")},{text:"Let's read again to see what the question is asking.",audioPath:e=>"assets/clinic/common-random_3-".concat(e,".mp3")},{text:"Shall we go over the key information in the problem again?",audioPath:e=>"assets/clinic/common-random_4-".concat(e,".mp3")},{text:"Look at the problem once more and check if you missed anything.",audioPath:e=>"assets/clinic/common-random_5-".concat(e,".mp3")},{text:"To better understand the problem, review the key terms again.",audioPath:e=>"assets/clinic/common-random_6-".concat(e,".mp3")},{text:"Think about how the information above might be used in the next question.",audioPath:e=>"assets/clinic/common-random_7-".concat(e,".mp3")},{text:"Now, let's look at the next question and review each part of the problem again.",audioPath:e=>"assets/clinic/common-random_8-".concat(e,".mp3")},{text:"Try reading the problem more slowly and think about it again.",audioPath:e=>"assets/clinic/common-random_9-".concat(e,".mp3")},{text:"Then, read the problem slowly again and think about the main point one more time.",audioPath:e=>"assets/clinic/common-random_10-".concat(e,".mp3")},{text:"Which part are you unsure about?",audioPath:e=>"assets/clinic/common-ST-".concat(e,".mp3")},{text:"Is there anything that you're unsure about?",audioPath:e=>"assets/clinic/common-group-".concat(e,".mp3")},{text:"then take a look at this",audioPath:e=>"assets/clinic/common-keyword-".concat(e,".mp3")},{text:"this vidoe should help you understand better",audioPath:e=>"assets/clinic/common-video-".concat(e,".mp3")},{text:"It might not make sense at first, and that's okay. Let's tackle the problem step by step together.",audioPath:e=>"assets/clinic/common-ST-cusion-1-".concat(e,".mp3")},{text:"Having trouble understanding? No worries—I'll guide you through it. Let's dive in!",audioPath:e=>"assets/clinic/common-ST-cusion-2-".concat(e,".mp3")},{text:"Starting can feel tough sometimes, and that's completely normal. Let's break it down one step at a time.",audioPath:e=>"assets/clinic/common-ST-cusion-3-".concat(e,".mp3")},{text:"If the problem feels overwhelming, don't worry—I'll lead the way. Let's work through it together!",audioPath:e=>"assets/clinic/common-ST-cusion-4-".concat(e,".mp3")},{text:"Still finding it tricky? That's okay. Let's take it slow and steady from here.",audioPath:e=>"assets/clinic/common-ST-cusion-5-".concat(e,".mp3")},{text:"Does it seem a little complicated? No problem—let's take our time and work through it step by step.",audioPath:e=>"assets/clinic/common-ST-cusion-6-".concat(e,".mp3")},{text:"Not quite sure about it yet? Don't worry—I'll walk you through the process. Let's begin!",audioPath:e=>"assets/clinic/common-ST-cusion-7-".concat(e,".mp3")},{text:"Was solving the problem more challenging than expected? I'm here to help you figure it out!",audioPath:e=>"assets/clinic/common-ST-cusion-8-".concat(e,".mp3")},{text:"It might not be easy right away, but that's okay. Let's work through it together now.",audioPath:e=>"assets/clinic/common-ST-cusion-9-".concat(e,".mp3")},{text:"Did it feel a bit tough? No need to worry—I'll help you every step of the way!",audioPath:e=>"assets/clinic/common-ST-cusion-10-".concat(e,".mp3")},{text:"Then take a look at this.",audioPath:e=>"assets/clinic/common-keyword-0-".concat(e,".mp3")},{text:"This explanation might help you",audioPath:e=>"assets/clinic/common-keyword-1-".concat(e,".mp3")},{text:"This should be helpful.",audioPath:e=>"assets/clinic/common-keyword-2-".concat(e,".mp3")},{text:"Why don't you take a look at this?",audioPath:e=>"assets/clinic/common-keyword-3-".concat(e,".mp3")},{text:"Reading this could be helpful.",audioPath:e=>"assets/clinic/common-keyword-4-".concat(e,".mp3")},{text:"Did my explanation help clear any of your confusions?",audioPath:e=>"assets/clinic/common-After_keyword_1-".concat(e,".mp3")},{text:"Did my explanation help you feel more comfortable with these type of problems?",audioPath:e=>"assets/clinic/common-After_keyword_2-".concat(e,".mp3")},{text:"Did I help clear all of your previous misunderstandings?",audioPath:e=>"assets/clinic/common-After_keyword_3-".concat(e,".mp3")},{text:"Are you confident enough to do these on your own?",audioPath:e=>"assets/clinic/common-After_keyword_4-".concat(e,".mp3")},{text:"Are you confident enough to think through these steps on your own?",audioPath:e=>"assets/clinic/common-After_keyword_5-".concat(e,".mp3")},{text:"If my explanation did not cover all of your questions, I can recommend you to one of my lectures.",audioPath:e=>"assets/clinic/common-After_keyword_6-".concat(e,".mp3")},{text:"If you are unsure, I have just the right lecture for you.",audioPath:e=>"assets/clinic/common-After_keyword_7-".concat(e,".mp3")},{text:"If you want to know more clearly, I'll cover it in detail with a lecture. How does that sound?",audioPath:e=>"assets/clinic/common-After_keyword_8-".concat(e,".mp3")},{text:"Lets review any parts we did not cover with a lecture.",audioPath:e=>"assets/clinic/common-After_keyword_9-".concat(e,".mp3")},{text:"If you need an simplified explanation, lets take a look at the quick lecture.",audioPath:e=>"assets/clinic/common-After_keyword_10-".concat(e,".mp3")},{text:"Don't worry! After watching the lectures, things will make much more sense.",audioPath:e=>"assets/clinic/common-before_Lecture_1-".concat(e,".mp3")},{text:"Feeling stuck right now is normal. Watching the lectures again will help clarify everything.",audioPath:e=>"assets/clinic/common-before_Lecture_2-".concat(e,".mp3")},{text:"It's okay if it's not clear yet. We'll take it step by step as we go through the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_3-".concat(e,".mp3")},{text:"No need to stress if you're confused right now. The lectures will make it easier to grasp.",audioPath:e=>"assets/clinic/common-before_Lecture_4-".concat(e,".mp3")},{text:"It might seem tricky at first, but it'll feel much simpler once you review the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_5-".concat(e,".mp3")},{text:"This is an important concept for moving forward. Let's study it together with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_6-".concat(e,".mp3")},{text:"The concept we just covered is essential. Let's explore it further with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_7-".concat(e,".mp3")},{text:"Understanding this concept is key to solving problems. Let's take the time to master it with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_8-".concat(e,".mp3")},{text:"What I just explained is a critical point. Let's dive deeper into it by watching the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_9-".concat(e,".mp3")},{text:"Truly understanding this concept is vital for tackling the problem. Let's break it down with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_10-".concat(e,".mp3")},{text:"Sorry, I didn't fully understand. Could you clarify a bit more, or should I start from the beginning?",audioPath:e=>"assets/clinic/common-sorry-".concat(e,".mp3")},{text:"I'm sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",audioPath:e=>"assets/clinic/common-zilmun-".concat(e,".mp3")},{text:"The clinic has ended. Now, try solving the problem again.",audioPath:e=>"assets/clinic/common-END-".concat(e,".mp3")}],l=(e,t)=>{if(!t)return null;let n=r.find(t=>t.text===e);return console.log("\uD83D\uDD35 [getAudioPath] mapping",n),console.log("\uD83D\uDD35 [getAudioPath] audioPath",null==n?void 0:n.audioPath(t)),n?n.audioPath(t):null},c=e=>null!==e&&"highlight_set"in e,u=()=>{let[e,t]=(0,s.useState)([]),[n,o]=(0,s.useState)(!1),i=async t=>{let{isOnlyText:n,text:o,message:i,teacherCode:s,hasChoiceButtons:u,clipSet:d,isMiddleQuestion:h=!1,audioURL:m}=t;if(n){let e=l(o,s);a.k.info("[streamText] Generated audioPath:",e);let t={text:o,sender:"bot",timestamp:new Date().toLocaleTimeString(),hasChoiceButtons:u,clip_set:d||null,audio:e,audioURL:m||null,highlight_set:c(i)?i.highlight_set:null,isMiddleQuestion:h};a.k.info("[streamText] Created newMessage:",t),await r(t),await new Promise(e=>setTimeout(e,0))}else if(i){var p;let t=i.variations.filter(e=>e.teacher_code===s);if(!t.length){r({text:i.content,sender:"bot",timestamp:new Date().toLocaleTimeString(),audio:null,audioURL:null,hasChoiceButtons:u,clip_set:null,highlight_set:null,isMiddleQuestion:h});return}let n=t[Math.floor(Math.random()*t.length)],o={text:null!==(p=null==n?void 0:n.variation_content)&&void 0!==p?p:i.content,sender:"bot",timestamp:new Date().toLocaleTimeString(),audio:(null==n?void 0:n.tts)||l(i.content,s),audioURL:null,hasChoiceButtons:u,clip_set:d||null,highlight_set:c(i)?i.highlight_set:null,isMiddleQuestion:h};await r(o),a.k.info("[streamText] Messages after adding:",e),await new Promise(e=>setTimeout(e,0))}},r=async e=>new Promise(n=>{t(t=>{let o=[...t,e];return n(),o})});return{messages:e,streamText:i,addMessage:r}};var d=n(48388),h=function(e,t,n){for(var o=n,i=0,s=e.length;o<t.length;){var a=t[o];if(i<=0&&t.slice(o,o+s)===e)return o;"\\"===a?o++:"{"===a?i++:"}"===a&&i--,o++}return -1},m=/^\\begin{/,p=function(e,t){for(var n,o=[],i=RegExp("("+t.map(e=>e.left.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")).join("|")+")");-1!==(n=e.search(i));){n>0&&(o.push({type:"text",data:e.slice(0,n)}),e=e.slice(n));var s=t.findIndex(t=>e.startsWith(t.left));if(-1===(n=h(t[s].right,e,t[s].left.length)))break;var a=e.slice(0,n+t[s].right.length),r=m.test(a)?a:e.slice(t[s].left.length,n);o.push({type:"math",data:r,rawData:a,display:t[s].display}),e=e.slice(n+t[s].right.length)}return""!==e&&o.push({type:"text",data:e}),o},f=function(e,t){var n=p(e,t.delimiters);if(1===n.length&&"text"===n[0].type)return null;for(var o=document.createDocumentFragment(),i=0;i<n.length;i++)if("text"===n[i].type)o.appendChild(document.createTextNode(n[i].data));else{var s=document.createElement("span"),a=n[i].data;t.displayMode=n[i].display;try{t.preProcess&&(a=t.preProcess(a)),d.Z.render(a,s,t)}catch(e){if(!(e instanceof d.Z.ParseError))throw e;t.errorCallback("KaTeX auto-render: Failed to parse `"+n[i].data+"` with ",e),o.appendChild(document.createTextNode(n[i].rawData));continue}o.appendChild(s)}return o},g=function e(t,n){for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];if(3===i.nodeType){for(var s=i.textContent,a=i.nextSibling,r=0;a&&a.nodeType===Node.TEXT_NODE;)s+=a.textContent,a=a.nextSibling,r++;var l=f(s,n);if(l){for(var c=0;c<r;c++)i.nextSibling.remove();o+=l.childNodes.length-1,t.replaceChild(l,i)}else o+=r}else 1===i.nodeType&&function(){var t=" "+i.className+" ";-1===n.ignoredTags.indexOf(i.nodeName.toLowerCase())&&n.ignoredClasses.every(e=>-1===t.indexOf(" "+e+" "))&&e(i,n)}()}},x=function(e,t){if(!e)throw Error("No element provided to render");var n={};for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);n.delimiters=n.delimiters||[{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\begin{CD}",right:"\\end{CD}",display:!0},{left:"\\[",right:"\\]",display:!0}],n.ignoredTags=n.ignoredTags||["script","noscript","style","textarea","pre","code","option"],n.ignoredClasses=n.ignoredClasses||[],n.errorCallback=n.errorCallback||console.error,n.macros=n.macros||{},g(e,n)};n(7395);let y=e=>e,C=e=>{let{content:t,className:n,style:o,useProcessor:a=!1,onLoad:r}=e,l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{null==r||r()},[r]),(0,s.useEffect)(()=>{if(l.current){let e=a?y(t):t;l.current.innerHTML=e,a||x(l.current,{delimiters:[{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"$$",right:"$$",display:!0}],throwOnError:!1,macros:{"\\frac":"\\dfrac"}})}},[t,a]),(0,i.jsx)("div",{ref:l,className:n,style:o})};var w=n(37440),T=n(56106);let S=(0,s.forwardRef)((e,t)=>{let{text:n,visibleMessages:o,onComplete:a,index:r,isMiddleQuestion:l}=e,[c,u]=(0,s.useState)(""),[d,h]=(0,s.useState)(!1),[m,p]=(0,s.useState)(!1);(0,s.useImperativeHandle)(t,()=>({completeTyping:()=>{u(n),h(!1),null==a||a()},startTyping:()=>{h(!0),u(""),p(!1)},isComplete:m}));let f=(0,s.useCallback)(()=>{u(n),p(!0)},[n]);return(0,s.useEffect)(()=>{if(l){f();return}o.length-1!==r&&f()},[r,o.length,f,l]),(0,s.useEffect)(()=>{if(d&&!m){if(c.length<n.length){let e=setTimeout(()=>{let e=c.length+1;if("$"===n[c.length]){let t=n.indexOf("$",c.length+1);-1!==t&&(e=t+1)}u(n.slice(0,e))},10);return()=>clearTimeout(e)}p(!0),o.length-1===r&&(null==a||a())}},[c.length,m,a,n,d,r,o.length]),(0,i.jsx)(C,{content:c+(m?"":" ")})});S.displayName="TypingBotMessage";let E=e=>{let{audioUrl:t,index:n,onComplete:o,setAudioRef:s}=e;return(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsxs)("audio",{ref:e=>s(e,n),controls:!0,className:"w-full max-w-[300px]",onEnded:()=>o(n),onError:e=>console.error("\uD83D\uDD0A [AudioPlayer] Error:",e),children:[(0,i.jsx)("source",{src:t,type:"audio/mp3"}),"Your browser does not support the audio element."]})})};var v=n(66648);let N=e=>{let{clips:t,onVodClick:n}=e,o=t[0];if(!o)return null;let s=o.lecture_vod_set[0];return s&&s.thumbnail_url?(0,i.jsx)("div",{"data-no-skip":"true",className:"overflow-x-auto w-full",children:(0,i.jsx)("div",{className:"inline-flex gap-4 pb-4",children:(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("div",{className:"flex flex-row gap-4",children:(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsxs)("div",{className:"cursor-pointer hover:opacity-80 transition-opacity relative w-[280px]",onClick:()=>n(o.code),children:[(0,i.jsxs)("div",{className:"relative bg-black rounded-lg",children:[(0,i.jsx)(v.default,{src:"".concat(s.thumbnail_url),alt:"".concat(s.title," thumbnail"),className:"w-full h-auto rounded-lg opacity-30",width:280,height:180}),(0,i.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,i.jsx)(v.default,{src:"/assets/images/icon_play.svg",alt:"play",className:"w-8 h-8",width:32,height:32})})]}),(0,i.jsx)("div",{className:"font-bold text-black mb-2 mt-2",children:s.title})]})})})})})}):null},_=e=>{let t;let n=new Set,o=(e,o)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=o?o:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:o,getState:i,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},a=t=e(o,i,s);return s},b=e=>e?_(e):_;var D=n(30794);let{useDebugValue:k}=s,{useSyncExternalStoreWithSelector:I}=D,j=!1,Q=e=>e,O=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?b(e):e,n=(e,n)=>(function(e,t=Q,n){n&&!j&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),j=!0);let o=I(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return k(o),o})(t,e,n);return Object.assign(n,t),n},U={default:["thinking…","Finding the best solution…","Preparing the perfect response…"],ocr:["Converting your handwriting...","Processing the image...","Reading the text from your image..."]},L=(o=(e,t)=>({isLoading:!1,type:"default",show:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return e({isLoading:!0,type:t})},hide:()=>e({isLoading:!1,type:"default"}),getLoadingMessages:()=>U[t().type]}))?O(o):O,R=e=>{let{sender:t,hasClipSet:n}=e,o="pl-[16px] py-[10px] rounded-[8px] select-none";return"user"===t?"".concat(o," bg-[#F3F3F3] max-w-[85%] px-[16px]"):n?"".concat(o," w-full"):"".concat(o," max-w-[85%]")},P=e=>{let{sender:t}=e;return"flex flex-col ".concat("user"===t?"justify-end":"justify-start"," ")},F=e=>{let{sender:t}=e;return"flex items-center ".concat("user"===t?"justify-end":"")},A=e=>{let t=e.match(/<img[^>]*>/);if(!t)return{text:e,imageHtml:null};let n=t[0].replace(/<img/,'<img class="w-full h-auto max-h-[140px] object-contain"');return{text:e.replace(/<img[^>]*>/,"").trim(),imageHtml:n}},M=e=>{let{messages:t,children:n,onShowNext:o,onMessageComplete:a,className:r,isLoading:l}=e,[c,u]=(0,s.useState)([]),[d,h]=(0,s.useState)(null),[m,p]=(0,s.useState)(!1),f=(0,s.useRef)([]),g=(0,s.useRef)([]),x=(0,s.useRef)(null),[y,_]=(0,s.useState)(0),{getLoadingMessages:b}=L(),D=b(),k=(0,s.useCallback)(e=>{let t=f.current[e];if(t)console.log("---------------------------------[playAudio]:",{index:e}),t.addEventListener("play",()=>{var t;console.log("Audio started playing, setting currentPlayingIndex:",e),null===(t=g.current[e])||void 0===t||t.startTyping()},{once:!0}),t.addEventListener("ended",()=>{h(null),j(e)},{once:!0}),h(e),t.muted=!0,t.play().then(()=>{t.muted=!1}).catch(t=>{var n;console.log("Audio playback failed:",t),null===(n=g.current[e])||void 0===n||n.startTyping()});else{var n;null===(n=g.current[e])||void 0===n||n.startTyping()}},[]),I=(0,s.useCallback)(e=>{let n=e+1;if(n>=t.length||c.includes(n))return;console.log("---------------------------------[showNextMessage]:",{currentIndex:e,nextIndex:n,totalMessages:t.length}),u(e=>Array.from(new Set([...e,n])).sort((e,t)=>e-t));let o=t[n];(o.audio||o.audioURL)&&k(n)},[t,c,k]),j=(0,s.useCallback)(e=>{console.log("---------------------------------[handleMessageComplete]:",{index:e,totalMessages:t.length,nextIndex:e+1,currentVisible:c}),a&&a(e),e+1<t.length&&setTimeout(()=>{I(e);let n=e+1;(t[n].audio||t[n].audioURL)&&k(n),x.current&&x.current.scrollIntoView({behavior:"smooth"})},100)},[t,a,I,k]);(0,s.useEffect)(()=>{if(t.length>0&&0===c.length){u([0]);let e=t[0];(e.audio||e.audioURL)&&(h(0),setTimeout(()=>{k(0)},0))}},[t.length,c.length,t,k]);let Q=(0,s.useCallback)((e,t)=>"bot"===e.sender&&c.includes(t)&&(e.audio||e.audioURL)&&!e.hasChoiceButtons&&d===t,[c,d]),O=(0,s.useCallback)(e=>{if(e.stopPropagation(),c.forEach(e=>{var t;null===(t=g.current[e])||void 0===t||t.completeTyping()}),null!==d){let e=f.current[d];e&&(e.pause(),e.currentTime=0),j(d);return}let t=c[c.length-1];void 0!==t&&j(t)},[d,c,j]),U=()=>{let e=x.current;e&&e.scrollIntoView({behavior:"smooth"})},M=(0,s.useCallback)(()=>{U()},[]),B=(0,s.useCallback)(e=>{u(t=>Array.from(new Set([...t,e])).sort((e,t)=>e-t)),M()},[M]),W=(0,s.useCallback)((e,n)=>{let o={isFirstMessage:0===e,isUserMessage:"user"===n.sender,isMiddleQuestion:n.isMiddleQuestion,hasPreviousUserMessage:e>0&&"user"===t[e-1].sender,isPreviousMessageVisible:e>0&&c.includes(e-1),isCurrentMessageNotVisible:!c.includes(e),isBotMessage:"bot"===n.sender};if(o.isFirstMessage||o.isUserMessage||o.isMiddleQuestion||o.hasPreviousUserMessage)return!0;if(o.isPreviousMessageVisible&&o.isCurrentMessageNotVisible&&o.isBotMessage){let n=t[e-1];return!(n.audio||n.audioURL)||d!==e-1}return!1},[t,c,d]),H=(0,s.useCallback)(()=>{if(null!==d){let e=f.current[d];e&&(e.pause(),e.currentTime=0,h(null))}},[d]);return(0,s.useEffect)(()=>{if(t.length>0){let e=t.length-1,n=t[e];if(n.isMiddleQuestion&&!c.includes(e)){H(),t.forEach((e,t)=>{if(g.current[t]){var n;null===(n=g.current[t])||void 0===n||n.completeTyping()}});let o=Array.from(new Set([...c,...t.map((e,t)=>t)]));JSON.stringify(o)!==JSON.stringify(c)&&(u(o),requestAnimationFrame(()=>{M()})),null!==d&&h(null),m&&p(!1),(n.audio||n.audioURL)&&setTimeout(()=>{k(e)},100);return}!c.includes(e)&&W(e,n)&&(B(e),(0,w.dz)(T.Q.CTOF_CLINIC_HIGHTLIGHT,{highlight_set:n.highlight_set}),(n.audio||n.audioURL)&&d!==e&&(H(),k(e)))}},[t,c,d,m,H,M]),(0,s.useEffect)(()=>{if(!x.current)return;let e=new ResizeObserver(e=>{for(let t of e)t.target===x.current&&U()});return e.observe(x.current),()=>{e.disconnect()}},[U]),(0,s.useEffect)(()=>{if(!l)return;let e=setInterval(()=>{_(e=>(e+1)%D.length)},2500);return()=>clearInterval(e)},[l]),(0,i.jsx)("div",{className:"h-full flex flex-col justify-end ".concat(r||""),onClick:O,children:(0,i.jsx)("div",{className:"overflow-y-auto",children:(0,i.jsxs)("div",{className:"p-4",children:[t.map((e,o)=>{let{text:s,imageHtml:a}=A(e.text);return(0,i.jsxs)("div",{className:P({sender:e.sender}),style:{opacity:c.includes(o)?1:0,transition:"opacity 0.3s ease-in-out, transform 0.3s ease-in-out",height:c.includes(o)?"auto":0,overflow:"hidden",marginBottom:t.length-1===o?"48px":"10px"},children:[(0,i.jsx)("div",{className:F({sender:e.sender}),style:{display:c.includes(o)?"flex":"none"},children:(0,i.jsxs)("div",{className:R({sender:e.sender,hasClipSet:!!e.clip_set}),children:[a&&(0,i.jsxs)("div",{className:"mb-2 relative flex justify-start items-center h-[140px]",children:[(0,i.jsx)("div",{className:"transition-all duration-300 ".concat(c.includes(o)?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:(0,i.jsx)("div",{className:"flex justify-start",dangerouslySetInnerHTML:{__html:a.replace(/<img/,'<img loading="eager" decoding="sync"')}})}),!c.includes(o)&&(0,i.jsx)("div",{className:"absolute inset-0 bg-gray-100 animate-pulse rounded"})]}),"user"===e.sender?(0,i.jsx)("div",{className:"text-[14px]",children:(0,i.jsx)(C,{content:e.text})}):(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("div",{className:"text-[14px]",children:(0,i.jsx)(S,{ref:e=>g.current[o]=e,text:s,visibleMessages:c,index:o,isMiddleQuestion:e.isMiddleQuestion})}),(e.audio||e.audioURL)&&(0,i.jsx)("div",{style:{display:"none"},children:(0,i.jsx)(E,{audioUrl:e.audioURL||e.audio||"",index:o,onComplete:()=>j(o),setAudioRef:e=>f.current[o]=e})}),e.clip_set&&(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)(N,{clips:e.clip_set,onVodClick:e=>{(0,w.dz)(T.Q.WTOF_CHAT_VIDEO_CLICK,e)}})})]})]})}),Q(e,o)&&(0,i.jsx)("div",{className:"px-[16px] pb-[8px]",style:{opacity:1,transform:"translateY(0)",transition:"opacity 300ms ease-in-out, transform 300ms ease-in-out"},children:(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"flex gap-4",children:(0,i.jsx)("button",{onClick:O,className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm rounded-lg hover:bg-[#666666]",children:"Skip"})})})}),"bot"===e.sender&&o===t.length-1&&c.includes(o)&&e.hasChoiceButtons&&(0,i.jsx)("div",{className:"mt-4",children:n})]},o)}),l&&(0,i.jsx)("div",{className:"flex justify-start text-black mt-4",children:(0,i.jsx)("div",{className:"relative max-w-[70%] px-5 py-2.5 bg-white rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(v.default,{src:"/assets/images/chalk-ai.png",alt:"chalk",width:18,height:18,className:"animate-spin rounded-full"}),(0,i.jsx)("div",{className:"h-[16px] relative overflow-hidden min-w-[200px]",children:(0,i.jsx)("span",{className:"text-[12px] text-[#ccc] block absolute w-full whitespace-nowrap animate-slideIn",children:D[y]},y)})]})})}),(0,i.jsx)("div",{ref:x})]})})})},B=()=>({requestTextConvert:e=>{(0,w.dz)(T.Q.WTOF_CONVERT_TEXT_REQUEST,{text:e})},onTextConverted:e=>{let t=n=>{let{type:o,data:i}=n.detail;o===T.Q.FTOW_CONVERT_TEXT_RESPONSE&&(e({text:i.text,textTTS:i.textTTS}),window.removeEventListener(T.Q.FTOW_EVENT_NAME,t))};return window.addEventListener(T.Q.FTOW_EVENT_NAME,t),()=>{window.removeEventListener(T.Q.FTOW_EVENT_NAME,t)}}}),W=e=>{let{nodes:t,deResponseType:n,setChangeClinicType:o,setClinicType:s,setClinicDEData:r,streamText:l,addMessage:c,currentBNodeIndex:u,setCurrentBNodeIndex:d,structuredBNodes:h,currentGroupIndex:m,setCurrentGroupIndex:p,currentQuestion:f,resetQuestionInfo:g,showProgress:x,hideProgress:y,isLoading:S}=e,{requestTextConvert:E,onTextConverted:v}=B(),N=async(e,t,n)=>{switch(a.k.info("\uD83D\uDCF1 [handleUserResponse] Start from DEBNodeButtons:",{type:e,nodeCode:null==t?void 0:t.code,index:n}),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e){case"CLICK":if(!t||void 0===n)return;await _(t,n);break;case"YES":await b(!0);break;case"NO":await b(!1)}},_=async(e,t)=>{console.log("=== DEBNodeButtons handleClick ==="),console.log("Selected B Node:",e),console.log("Selected Index:",t),console.log("Current structuredBNodes:",h),a.k.info("\uD83D\uDCF1 [handleClick] Calling Flutter handler from DEBNodeButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await c({text:e.shortcut_content||"",sender:"user",timestamp:new Date().toLocaleTimeString()}),o(!1);try{let e=h[t];if(e.children){let n=Object.keys(e.children)[0],i=e.children[n];if(i.length>0){r(i),d(t);for(let e=0;e<i.length;e++)await l({isOnlyText:!1,text:"",message:i[e],teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await l({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),console.log("Setting States - currentBNodeIndex:",t),o(!0),p(m+1)}}}catch(e){console.error("Failed to get next DE data:",e)}},b=async e=>{if(a.k.info("\uD83D\uDCF1 [handleUnderstandResponse] Calling Flutter handler from DEBNodeButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await c({text:e?"Yes, I know.":"No, I don't know.",sender:"user",timestamp:new Date().toLocaleTimeString()}),e){let e=h[u+1];if(a.k.info("✅ [handleUnderstandResponse] Yes path - Current Node:",{currentNode:e,currentBNodeIndex:u+1}),void 0===e)a.k.info("⚠️ [handleUnderstandResponse] Conversation ended - no more nodes"),g(),await l({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),s("END"),o(!0),await new Promise(e=>setTimeout(e,500));else if(!e.isVariationsShown){for(let t of(a.k.info("\uD83D\uDD04 [handleUnderstandResponse] Showing variations first time:",{nodeCode:e.code,variations:e.variations,teacherCode:f.teacherCode}),r([e]),[e]))a.k.info("\uD83D\uDCE4 [handleUnderstandResponse] Streaming variation message:",{messageCode:t.code,content:t.content,teacherCode:f.teacherCode}),await l({isOnlyText:!1,text:"",message:t,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});a.k.info("✏️ [handleUnderstandResponse] Marking variations as shown"),h[u+1]={...e,isVariationsShown:!0},d(u+1)}}else try{let e=h[u];x();let t=v(async e=>{y(),await D(e)});return E(e.content),()=>t()}catch(e){y(),a.k.error("❌ [handleUnderstandResponse] Error:",e)}a.k.info("\uD83D\uDCF1 [handleUnderstandResponse] Calling Flutter handler:",{eventType:e})},D=async e=>{let t=h[u];if(null!==e.text&&await l({isOnlyText:!0,text:e.text,message:null,teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1,audioURL:e.textTTS}),await new Promise(e=>setTimeout(e,500)),t.children){let e=Object.keys(t.children)[0],n=t.children[e];for(let t of(a.k.info("\uD83D\uDD0D [handleUnderstandResponse] First group details:",{groupName:e,messageCount:n.length,teacherCode:f.teacherCode}),n))a.k.info("\uD83D\uDCE4 [handleUnderstandResponse] Streaming C-type message:",{messageCode:t.code,content:t.content}),await l({isOnlyText:!1,text:"",message:t,teacherCode:f.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),await new Promise(e=>setTimeout(e,100));await l({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:f.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("\uD83D\uDD04 [handleUnderstandResponse] Switching to C-type mode"),r(n),o(!0),p(1)}};return(0,i.jsx)("div",{className:"flex flex-col gap-2",children:n?(0,i.jsx)(i.Fragment,{children:t.map((e,t)=>(0,i.jsxs)("button",{onClick:()=>N("CLICK",e,t),className:"min-w-[100px] bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 text-sm rounded-[8px] text-left",children:[t+1,".",(0,i.jsx)(C,{content:e.shortcut_content||"",className:"text-gray-800"})]},e.code))}):(0,i.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,i.jsx)("button",{onClick:()=>N("YES"),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"Yes, I know."}),(0,i.jsx)("button",{onClick:()=>N("NO"),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"No, I don't know."})]})})},H=["If you're still unsure, try reading the problem again.","Then, read the problem again and check the given conditions.","Let's read again to see what the question is asking.","Shall we go over the key information in the problem again?","Look at the problem once more and check if you missed anything.","To better understand the problem, review the key terms again.","Think about how the information above might be used in the next question.","Now, let's look at the next question and review each part of the problem again.","Try reading the problem more slowly and think about it again.","Then, read the problem slowly again and think about the main point one more time."],V=["It might not make sense at first, and that's okay. Let's tackle the problem step by step together.","Having trouble understanding? No worries—I'll guide you through it. Let's dive in!","Starting can feel tough sometimes, and that's completely normal. Let's break it down one step at a time.","If the problem feels overwhelming, don't worry—I'll lead the way. Let's work through it together!","Still finding it tricky? That's okay. Let's take it slow and steady from here.","Does it seem a little complicated? No problem—let's take our time and work through it step by step.","Not quite sure about it yet? Don't worry—I'll walk you through the process. Let's begin!","Was solving the problem more challenging than expected? I'm here to help you figure it out!","It might not be easy right away, but that's okay. Let's work through it together now.","Did it feel a bit tough? No need to worry—I'll help you every step of the way!"],G=["Then take a look at this.","This explanation might help you.","This should be helpful.","Why don't you take a look at this?","Reading this could be helpful."],q=["Did my explanation help clear any of your confusions?","Did my explanation help you feel more comfortable with these type of problems?","Did I help clear all of your previous misunderstandings?","Are you confident enough to do these on your own?","Are you confident enough to think through these steps on your own?","If my explanation did not cover all of your questions, I can recommend you to one of my lectures.","If you are unsure, I have just the right lecture for you.","If you want to know more clearly, I'll cover it in detail with a lecture. How does that sound?","Lets review any parts we did not cover with a lecture.","If you need an simplified explanation, lets take a look at the quick lecture."],z=["Don't worry! After watching the lectures, things will make much more sense.","Feeling stuck right now is normal. Watching the lectures again will help clarify everything.","It's okay if it's not clear yet. We'll take it step by step as we go through the lectures.","No need to stress if you're confused right now. The lectures will make it easier to grasp.","It might seem tricky at first, but it'll feel much simpler once you review the lectures.","This is an important concept for moving forward. Let's study it together with the lectures.","The concept we just covered is essential. Let's explore it further with the lectures.","Understanding this concept is key to solving problems. Let's take the time to master it with the lectures.","What I just explained is a critical point. Let's dive deeper into it by watching the lectures.","Truly understanding this concept is vital for tackling the problem. Let's break it down with the lectures."],$=e=>{let{nodes:t,setChangeClinicType:n,setDeResponseType:o,streamText:s,addMessage:r,setClinicDEData:l,currentBNodeIndex:c,setCurrentBNodeIndex:u,structuredBNodes:d,currentGroupIndex:h,setCurrentGroupIndex:m,currentQuestion:p,setClinicType:f,resetQuestionInfo:g}=e,x=e=>e?e.replace(/<img[^>]*>/g,"").replace(/<br\s*\/?>/g,"").replace(/<p>\s*<\/p>/g,""):"",y=async e=>{if(a.k.info("\uD83D\uDCF1 [handleClick] Calling Flutter handler from DECNodeButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await r({text:x(e.content||""),sender:"user",timestamp:new Date().toLocaleTimeString()}),e.keyword_set){console.log("handleClick - keyword_set",e);try{let t=G[Math.floor(Math.random()*G.length)];for(let o of(await s({isOnlyText:!0,text:t,message:null,teacherCode:p.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),e.keyword_set))console.log("keywordInfo",o),o?(await s({isOnlyText:!1,text:"",message:o,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),l([{code:o.code,depth:"keyword",children:null,isVariationsShown:!1,highlight_set:[],keyword_set:[],option_set:[],variations:[],shortcut_content:null,option_type:"",order:0,group_name:null,clinic_type:"DE",type_index:0,parent:null,tag_set:[],content:o.content,clip_set:e.clip_set}]),n(!0)):await s({isOnlyText:!0,text:"키워드 데이터를 찾을 수 없어요.",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});let o=q[Math.floor(Math.random()*q.length)];await s({isOnlyText:!0,text:o,message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1})}catch(e){console.error("Failed to get keyword data:",e)}}},S=async()=>{try{console.log("=== DECNodeButtons handleContinue ==="),console.log("Current BNode Index:",c),console.log("Current Group Index:",h),a.k.info("\uD83D\uDCF1 [handleContinue] Calling Flutter handler from DECNodeButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await r({text:"Next Explanation",sender:"user",timestamp:new Date().toLocaleTimeString()});let e=d[c];if(e.children){let t=Object.keys(e.children);a.k.info("Group Names:",t);let i=t[h];if(a.k.info("Next Group Name:",i),i){let t=e.children[i];for(let e of t)a.k.info("Streaming message:",e),await s({isOnlyText:!1,text:"",message:e,teacherCode:p.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await s({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),l(t),n(!0),m(h+1)}else if(c+1<d.length){let e=d[c+1];await s({isOnlyText:!1,text:"",message:e,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),o(!1),l([e]),n(!0),u(c+1),m(0)}else g(),await s({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),l([]),f("END"),n(!0),await new Promise(e=>setTimeout(e,500))}}catch(e){console.error("Failed to get next DE data:",e)}};return(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[t.map(e=>(0,i.jsx)("button",{onClick:()=>y(e),className:"min-w-[100px] bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 text-sm rounded-[8px] text-left",children:(0,i.jsx)(C,{content:x(e.content||""),className:"text-gray-800"})},e.code)),(0,i.jsx)("div",{className:"flex justify-start",children:(0,i.jsx)("button",{onClick:S,className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"Next Explanation"})})]})},K=e=>{let{onUserResponse:t,showNextButton:n,currentQuestion:o}=e,s=async e=>{switch(a.k.info("\uD83D\uDCF1 [handleUserResponse] Start:",{type:e}),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e){case"YES":case"NEXT":t("AN",!0);break;case"NO":t("AN",!1)}};return(0,i.jsx)("div",{className:"flex gap-4",children:n?(0,i.jsx)("button",{onClick:()=>s("NEXT"),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"Next"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:()=>s("YES"),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"Yes"}),(0,i.jsx)("button",{onClick:()=>s("NO"),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"No"})]})})},Y=e=>{let{getClinicData:t,currentQuestion:n,onUserResponse:o}=e,s=async()=>{a.k.info("\uD83D\uDCF1 [handleStartSolving] Calling Flutter handler from STClinicButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),o("ST",!0,"Yes, I was working on it")},r=async()=>{a.k.info("\uD83D\uDCF1 [handleNotStarted] Calling Flutter handler from STClinicButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),o("ST",!1,"I don’t know how to start")};return(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsx)("button",{onClick:s,className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"Yes, I was working on it"}),(0,i.jsx)("button",{onClick:r,className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"I don’t know how to start"})]})},X=e=>{let{currentKeywordCode:t,setChangeClinicType:n,streamText:o,addMessage:s,onContinue:r,setClinicDEData:l,nodes:c,currentQuestion:u}=e,d=async e=>{let i={text:e?"I understand.":"I’m not quite sure.",sender:"user",timestamp:new Date().toLocaleTimeString()};if(await s(i),a.k.info("\uD83D\uDCF1 [handleUnderstand] Calling Flutter handler from DEKeywordNodeButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e)r();else try{let e=z[Math.floor(Math.random()*z.length)];await o({isOnlyText:!0,text:e,message:null,teacherCode:u.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),await o({isOnlyText:!0,text:"",message:null,teacherCode:u.teacherCode,hasChoiceButtons:!0,clipSet:c[0].clip_set,isMiddleQuestion:!1}),l([{depth:"clip",code:t,children:null,isVariationsShown:!1,highlight_set:[],keyword_set:[],option_set:[],variations:[],shortcut_content:null,option_type:"",order:0,group_name:null,clinic_type:"DE",type_index:0,parent:null,tag_set:[],content:"",clip_set:c[0].clip_set}]),n(!0)}catch(e){console.error("Failed to get additional keyword data:",e)}};return(0,i.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,i.jsx)("button",{onClick:()=>d(!0),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"I understand."}),(0,i.jsx)("button",{onClick:()=>d(!1),className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"I’m not quite sure."})]})},Z=e=>{let{addMessage:t,onContinue:n}=e,o=async()=>{a.k.info("\uD83D\uDCF1 [handleUnderstand] Calling Flutter handler from DEClipNodeButtons"),(0,w.dz)(T.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await t({text:"Check another point",sender:"user",timestamp:new Date().toLocaleTimeString()}),await n()};return(0,i.jsx)("div",{className:"flex flex-row gap-2",children:(0,i.jsx)("button",{onClick:o,className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"Check another point"})})},J=e=>{var t,n,o,r;let{messages:l,showNextMessage:c,clinicType:u,changeClinicType:d,deResponseType:h,setDeResponseType:m,currentBNodeIndex:p,setCurrentBNodeIndex:f,structuredBNodes:g,setStructuredBNodes:x,currentGroupIndex:y,setCurrentGroupIndex:C,addMessage:w,streamText:T,setClinicType:S,setChangeClinicType:E,setClinicData:v,showNextButton:N,setShowNextButton:_,middleQuestionStatus:b,initialize:D,getClinicData:k,currentQuestion:I,setQuestionInfo:j,resetQuestionInfo:Q,showProgress:O,hideProgress:U,isLoading:L,...R}=e;(0,s.useEffect)(()=>{d||(m(!1),_(!1))},[d,m,_]);let P=async(e,t,n)=>{a.k.info("[handleUserResponse] Start",{clinicType:e,isYes:t,customText:n});let o={text:n||(t?"Yes":"No"),sender:"user",timestamp:new Date().toLocaleTimeString()};if(await w(o),await new Promise(e=>setTimeout(e,50)),"AN"===e){if(t)try{a.k.info("[handleUserResponse] Loading data for ST",I.code,I.teacherCode);let e=await k("ST",I.code);if(a.k.info("[handleUserResponse] ST data received:",e),!e||0===e.length){a.k.info("[handleUserResponse] No ST data available");return}let t=e.filter((t,n)=>e.findIndex(e=>e.content===t.content)===n);for(let e of(v(t),t))a.k.info("[handleUserResponse] About to stream message",{code:e.code,content:e.content}),await T({isOnlyText:!1,text:"",message:e,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),await new Promise(e=>setTimeout(e,100)),a.k.info("[handleUserResponse] Message streamed successfully");a.k.info("[handleUserResponse] Before setting ST type"),S("ST"),E(!0),a.k.info("[handleUserResponse] After setting ST type")}catch(e){a.k.info("[handleUserResponse] Error:",e)}else{let e=H[Math.floor(Math.random()*H.length)];await T({isOnlyText:!0,text:e,message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),_(!0)}}else if("ST"===e){if(a.k.info("[handleUserResponse] Handling ST response",{isYes:t}),a.k.info("[handleUserResponse] ST clinic type"),t){await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await k("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),R.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}}else try{let e=await k("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),R.setClinicDEData(t),x(t),S("DE"),E(!0),m(!1);let o=t[p];if(a.k.info("Current Node:",o),!o.isVariationsShown){a.k.info("Showing Node Variations First Time"),a.k.info("Node to show:",o),R.setClinicDEData([o]);let e=V[Math.floor(Math.random()*V.length)];for(let t of(await T({isOnlyText:!0,text:e,message:null,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),[o]))a.k.info("Streaming Node Message:",t),await T({isOnlyText:!1,text:"",message:t,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});a.k.info("Marking variations as shown"),t[p]={...o,isVariationsShown:!0};return}}catch(e){console.error("Failed to get DE clinic data:",e)}}};return(0,i.jsxs)("div",{className:"px-[16px] pb-[8px]",children:["AN"===u&&(0,i.jsx)("div",{children:(0,i.jsx)(K,{onUserResponse:P,showNextButton:N,currentQuestion:I})}),"ST"===u&&(0,i.jsx)("div",{children:(0,i.jsx)(Y,{...R,getClinicData:k,currentQuestion:I,addMessage:w,setClinicType:S,setChangeClinicType:E,streamText:T,onUserResponse:P,deResponseType:h,setDeResponseType:m,structuredBNodes:g,setStructuredBNodes:x})}),"DE"===u&&(0,i.jsxs)(i.Fragment,{children:[(null===(t=R.clinicDEData[0])||void 0===t?void 0:t.depth)==="B"&&(0,i.jsx)(W,{setClinicType:S,currentQuestion:I,deResponseType:h,nodes:R.clinicDEData,setChangeClinicType:E,setClinicDEData:R.setClinicDEData,streamText:T,addMessage:w,currentBNodeIndex:p,setCurrentBNodeIndex:f,structuredBNodes:g,currentGroupIndex:y,setCurrentGroupIndex:C,resetQuestionInfo:Q,showProgress:O,hideProgress:U,isLoading:L}),(null===(n=R.clinicDEData[0])||void 0===n?void 0:n.depth)==="C"&&(0,i.jsx)($,{currentQuestion:I,setClinicType:S,structuredBNodes:g,nodes:R.clinicDEData,currentBNodeIndex:p,setCurrentBNodeIndex:f,setChangeClinicType:E,streamText:T,addMessage:w,setClinicDEData:R.setClinicDEData,setDeResponseType:m,currentGroupIndex:y,setCurrentGroupIndex:C,resetQuestionInfo:Q}),(null===(o=R.clinicDEData[0])||void 0===o?void 0:o.depth)==="keyword"&&(0,i.jsx)(X,{currentQuestion:I,currentKeywordCode:R.clinicDEData[0].code,setChangeClinicType:E,setDeResponseType:m,streamText:T,addMessage:w,setClinicDEData:R.setClinicDEData,nodes:R.clinicDEData,onContinue:async()=>{let e=p+1;e>=g.length&&(a.k.warn("No more nodes available:",{currentIndex:p,totalNodes:g.length}),Q(),await T({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),S("END"),E(!0),await new Promise(e=>setTimeout(e,500)));let t=g[e];if(null==t?void 0:t.children){let e=Object.keys(t.children)[0],n=t.children[e];await T({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("Setting States - currentBNodeIndex:",1),E(!0),R.setClinicDEData(n),f(p+1)}}}),(null===(r=R.clinicDEData[0])||void 0===r?void 0:r.depth)==="clip"&&(0,i.jsx)(Z,{addMessage:w,onContinue:async()=>{let e=g[p];if(null==e?void 0:e.children){let t=Object.keys(e.children)[0],n=e.children[t];await T({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("Setting States - currentBNodeIndex:",p),E(!0),R.setClinicDEData(n),f(p)}}})]}),"MQ"===u&&(0,i.jsx)("div",{className:"flex flex-row gap-2",children:"Notfound"===b.status?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:async()=>{let e={text:"From Beginning",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),Q(),await new Promise(e=>setTimeout(e,50)),S("AN"),E(!0),await D()},className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm rounded-lg",children:"From Beginning"}),(0,i.jsx)("button",{onClick:async()=>{let e={text:"Continue Explanation",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await k("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),R.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm rounded-lg",children:"Continue Explanation"})]}):"Fail"===b.status?(0,i.jsx)("button",{onClick:async()=>{let e={text:"Continue Explanation",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await k("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),R.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm rounded-lg",children:"Continue Explanation"}):null}),"HINT"===u&&(0,i.jsx)("div",{className:"flex flex-row gap-2",children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:async()=>{let e={text:"Yes",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e);let t=await k("DE",I.code),n=[],o=null;t.forEach(e=>{if("B"===e.depth){let t={...e,children:{},isVariationsShown:!1};n.push(t),o=t}else if("C"===e.depth&&o){let t=e.group_name||"default";o.children[t]||(o.children[t]=[]),o.children[t].push(e)}});let i=n.findIndex(e=>e.code===I.clinicCode);if(-1!==i){let e=n[i];if(await T({isOnlyText:!0,text:I.introText||"",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1,audioURL:I.introTTS}),await new Promise(e=>setTimeout(e,500)),x(n),S("DE"),E(!0),m(!0),e.children){let t=Object.keys(e.children)[0],n=e.children[t];for(let e of(R.setClinicDEData(n),n))a.k.info("[initialize] streamText",e),await T({isOnlyText:!1,text:"",message:e,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await T({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),f(i)}}},className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm rounded-lg",children:"Yes"}),(0,i.jsx)("button",{onClick:async()=>{let e={text:"No",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await k("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),R.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"No"})]})}),"END"===u&&(0,i.jsx)("div",{className:"flex flex-row gap-2",children:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("button",{onClick:async()=>{let e={text:"From Beginning",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),S("AN"),E(!0),await D()},className:"min-w-[100px] bg-[#767676] text-white px-4 py-2 text-sm  rounded-lg",children:"From Beginning"})})})]})};var ee=n(48034);let et=!1,en=e=>{let{addMessage:t,setChangeClinicType:o}=e,[i,r]=(0,s.useState)(!1),[l,c]=(0,s.useState)([]),[u,d]=(0,s.useState)([]),[h,m]=(0,s.useState)({code:"",teacherCode:"",clinicCode:null,hintText:null,introText:null,hintTTS:null,introTTS:null}),[p,f]=(0,s.useState)({status:null,timestamp:0}),{show:g,hide:x}=L();(0,s.useEffect)(()=>{{if(!h.code||!h.teacherCode){a.k.warn("⚠️ [localStorage] Preventing empty save:",h);return}let e=localStorage.getItem("currentQuestion"),t=e?JSON.parse(e):null;if(t&&t.code===h.code&&t.teacherCode===h.teacherCode&&t.clinicCode===h.clinicCode)return;localStorage.setItem("currentQuestion",JSON.stringify(h)),a.k.info("\uD83D\uDD04 [localStorage] Updated:",h)}},[h]);let y=(0,s.useCallback)(()=>u.length>0,[u]),C=(0,s.useCallback)(async(e,t)=>{try{if(y())return a.k.info("\uD83D\uDD35 [loadOriginalData] Data already loaded:",{dataLength:u.length}),u;a.k.info("\uD83D\uDD35 [loadOriginalData] Loading new data for:",{questionCode:e,teacherCode:t});let o=await n(44415)("./".concat(e,".json"));if(!(null==o?void 0:o.default)||!Array.isArray(o.default))throw Error("Invalid data format for ".concat(e));let i=o.default;return d(i),c(i),a.k.info("\uD83D\uDD35 [loadOriginalData] New data loaded:",{length:i.length}),i}catch(e){throw a.k.error("❌ [loadOriginalData] Error:",e),e}},[u,y]),w=async(e,t)=>{try{h.teacherCode||a.k.warn("⚠️ [getClinicData] teacherCode is empty!");let o=t||h.code,i=h.teacherCode;y()||await C(o,i);let s=await n(44415)("./".concat(o,".json"));if(!(null==s?void 0:s.default)||!Array.isArray(s.default))throw Error("Invalid data format for ".concat(o));return s.default.filter(t=>t.clinic_type===e)}catch(e){return a.k.error("getClinicData","Error:",e),[]}},S=(0,s.useCallback)((e,t,n,o,i,s,a)=>{m(r=>({code:e,teacherCode:void 0!==t?t:r.teacherCode,clinicCode:void 0===n?r.clinicCode:n,hintText:void 0!==o?o:r.hintText,introText:void 0!==i?i:r.introText,hintTTS:void 0!==s?s:r.hintTTS,introTTS:void 0!==a?a:r.introTTS}))},[]);return(0,s.useRef)(!1),(0,s.useEffect)(()=>{},[]),(0,s.useEffect)(()=>{async function e(e){a.k.info("[eventHandler] Received event:",e);try{if(!e.detail){a.k.info("⚠️ [eventHandler] No event detail");return}let{type:n,data:i}=e.detail;if(a.k.info("\uD83D\uDD35 [eventHandler] Processing event:",{type:n,data:i}),n===T.Q.FTOW_CLINIC_INITIAL_LOADING)a.k.info("\uD83D\uDD35 [eventHandler] OCR loading start"),g("ocr");else if(n===T.Q.FTOW_CLINICK){et||(localStorage.removeItem("currentQuestion"),a.k.info("\uD83D\uDD04 [eventHandler] Initial localStorage clear"),et=!0);let e="string"==typeof i?i:i.questionCode,t="string"==typeof i?h.teacherCode:i.teacherCode,n="string"==typeof i?null:i.clinicCode,o="string"==typeof i?null:i.hintText,s="string"==typeof i?null:i.introText,l="string"==typeof i?null:i.hintTTS,c="string"==typeof i?null:i.introTTS;a.k.info("\uD83D\uDD35 [eventHandler] Loading data for:",{questionCode:e,teacherCode:t,clinicCode:n,hintText:o,introText:s,hintTTS:l,introTTS:c}),e&&(r(!0),await C(e,t),S(e,t,n,o,s,l,c),r(!1)),x()}else if(n===T.Q.FTOW_CLINIC_START_MIDLE_QUESTION){if(a.k.info("\uD83D\uDD35 [eventHandler] Middle question start"),console.log("setMiddleQuestionStatus init",p),i&&"object"==typeof i){let{status:e,clinicCode:t,hintText:n,introText:o,hintTTS:s,introTTS:l}=i;a.k.info("\uD83D\uDD35 [eventHandler] Loading middle question data:",{status:e,clinicCode:t,hintText:n,introText:o,hintTTS:s,introTTS:l});let c=localStorage.getItem("currentQuestion");if(c){let{code:i,teacherCode:u}=JSON.parse(c);a.k.info("\uD83D\uDD35 [eventHandler] Using saved question info:",{questionCode:i,teacherCode:u,clinicCode:t}),r(!0);try{S(i,u,t,n,o,s,l),await new Promise(e=>setTimeout(e,0)),f({status:null,timestamp:0}),await new Promise(e=>setTimeout(e,10)),f({status:e,timestamp:Date.now()})}finally{x(),r(!1)}}else a.k.warn("⚠️ [eventHandler] No saved question info found in localStorage")}}else if(n===T.Q.FTOW_CLINIC_USER_FEEDBACK_MESSAGE){a.k.info("\uD83D\uDD35 [eventHandler] User feedback message received:",i);let e={text:i.userMessage,sender:"user",timestamp:new Date().toLocaleTimeString()};await t(e),o(!1),g()}else a.k.info("⚠️ [eventHandler] Unknown event type:",n)}catch(e){a.k.error("[eventHandler] Error:",e),r(!1)}}return window.addEventListener(T.Q.FTOW_EVENT_NAME,e),ee.d.onEvent(e=>{a.k.info("✅ [eventStore] Event received:",e);try{window.dispatchEvent(new CustomEvent(T.Q.FTOW_EVENT_NAME,{detail:{type:e.type,data:e.data}})),a.k.info("✅ [eventStore] Event dispatched successfully")}catch(e){a.k.info("❌ [eventStore] Failed to dispatch event:",e)}}),ee.d.setReady(),()=>{window.removeEventListener(T.Q.FTOW_EVENT_NAME,e),a.k.info("\uD83D\uDD35 [useEffect cleanup] Preserving originalData:",{exists:!!u,length:u.length})}},[]),{getClinicData:w,loading:i,clinicData:l,setClinicData:c,originalData:u,currentQuestion:h,setQuestionInfo:S,middleQuestionStatus:p,resetQuestionInfo:(0,s.useCallback)(()=>{m(e=>({code:e.code,teacherCode:e.teacherCode,clinicCode:null,hintText:null,introText:null,hintTTS:null,introTTS:null})),f({status:null,timestamp:0})},[])}};var eo=()=>{let[e,t]=(0,s.useState)("AI_TEACHER"),[n,o]=(0,s.useState)(!1),{messages:r,streamText:l,addMessage:c}=u(),{getClinicData:d,clinicData:h,setClinicData:m,currentQuestion:p,middleQuestionStatus:f,setQuestionInfo:g,resetQuestionInfo:x}=en({addMessage:c,setChangeClinicType:o}),[y,C]=(0,s.useState)([]),[w,T]=(0,s.useState)("AN"),S=(0,s.useRef)(!1),[E,v]=(0,s.useState)([]),[N,_]=(0,s.useState)(!1),[b,D]=(0,s.useState)(0),[k,I]=(0,s.useState)(0),[j,Q]=(0,s.useState)(!1),[O,U]=(0,s.useState)(null),{isLoading:R,show:P,hide:F}=L(),A=(0,s.useCallback)(e=>{U(()=>e)},[]),B=async()=>{try{if(!p.code){a.k.info("[initialize] Waiting for question code");return}if(console.log("[initialize] middleQuestionStatus: ",f),null!==f.status&&a.k.info("[initialize] Skipping due to middle question handling"),o(!0),p.clinicCode)T("HINT"),await l({isOnlyText:!0,text:p.hintText||"",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1,audioURL:p.hintTTS});else{let e=await d("AN",p.code),t=e.filter((t,n)=>e.findIndex(e=>e.content===t.content)===n);for(let e of(m(t),t))await l({isOnlyText:!1,text:"",message:e,teacherCode:p.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await l({isOnlyText:!0,text:"Do you understand everything so far?",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1})}S.current=!0}catch(e){console.error("[initialize] Error:",e),o(!0)}};return(0,s.useEffect)(()=>{a.k.info("[ClinicChatbotClient] useEffect",{currentQuestion:p}),p.code&&B()},[p.code,p.clinicCode]),(0,s.useEffect)(()=>{(async()=>{if(f.status&&0!==f.timestamp&&!n)try{o(!0),"Success"===f.status?a.k.info("[ClinicChatbotClient] Middle question started successfully"):"Notfound"===f.status?(a.k.info("[ClinicChatbotClient] Middle question not found"),await l({isOnlyText:!0,text:"Sorry, I didn't fully understand. Could you clarify a bit more, or should I start from the beginning?",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!0}),T("MQ")):"Fail"===f.status&&(a.k.info("[ClinicChatbotClient] Middle question failed"),await l({isOnlyText:!0,text:"I'm sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!0,audioURL:null}),T("MQ"))}catch(e){o(!1),console.error(e)}})()},[f.timestamp,p.teacherCode]),(0,i.jsxs)("div",{className:"h-full min-h-[100vh] flex flex-col bg-white text-black",children:[!1,(0,i.jsx)("div",{className:"flex-shrink-0 p-[16px] pt-[12px] border-b border-[#f5f5f5] justify-start flex gap-2",children:[{id:"AI_TEACHER",label:"AI Teacher"},{id:"NOTIFICATION",label:"Notification"},{id:"WRONG_ANSWER",label:"Incorrect Solutions"},{id:"WEAKNESS",label:"Weakness Analysis"}].map(t=>(0,i.jsx)("button",{onClick:()=>{},className:"border px-[18px] w-min py-[10px] rounded-[6px] font-medium text-[13px] text-center ".concat(e===t.id?"border-[#ebebeb] text-[#333]":"border-transparent text-[#767676]"),children:t.label},t.id))}),(0,i.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",onClick:e=>{let t=e.target;if(t.closest("button")||t.closest('[data-no-skip="true"]'))return;let n=document.querySelector(".message-list");n&&n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))},children:(0,i.jsx)(M,{className:"message-list h-full",messages:r,onShowNext:A,isLoading:R,children:(0,i.jsx)(J,{messages:r,showNextMessage:O,clinicType:w,changeClinicType:n,setChangeClinicType:o,deResponseType:N,setDeResponseType:_,clinicData:h,clinicDEData:y,currentBNodeIndex:b,setCurrentBNodeIndex:D,setClinicData:m,setClinicDEData:C,structuredBNodes:E,setStructuredBNodes:v,setClinicType:T,streamText:l,addMessage:c,currentGroupIndex:k,setCurrentGroupIndex:I,showNextButton:j,setShowNextButton:Q,middleQuestionStatus:f,initialize:B,getClinicData:d,currentQuestion:p,setQuestionInfo:g,resetQuestionInfo:x,showProgress:P,hideProgress:F,isLoading:R})})})]})};function ei(){return(0,s.useEffect)(()=>{window.learnScreenEventChannel=function(e,t){ee.d.addEvent({type:e,data:JSON.parse(JSON.stringify(t))})}},[]),(0,i.jsx)(s.Suspense,{fallback:(0,i.jsx)("div",{children:"Loading..."}),children:(0,i.jsx)(eo,{})})}},63090:function(e,t,n){"use strict";function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];try{let t=n.map(e=>{if("object"==typeof e)try{return JSON.stringify(e,null,2)}catch(e){return"[Complex Object]"}return String(e)}).join(" ");console.log("".concat(e,": ").concat(t))}catch(e){console.error("Logger Error:",e)}}n.d(t,{k:function(){return i}});let i={info:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("ℹ️ [".concat(e,"]"),...n)},success:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("✅ [".concat(e,"]"),...n)},warn:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("⚠️ [".concat(e,"]"),...n)},error:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("❌ [".concat(e,"]"),...n)},debug:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("\uD83D\uDD35 [".concat(e,"]"),...n)}}},37440:function(e,t,n){"use strict";n.d(t,{cn:function(){return r},dz:function(){return c},l_:function(){return u},lr:function(){return h},q1:function(){return d}});var o=n(48388);n(7395);var i=n(44839),s=n(96164),a=n(27776);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,i.W)(t))}let l=()=>!!window.flutter_inappwebview,c=async function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(l())try{return JSON.parse(await window.flutter_inappwebview.callHandler(e,...n.map(e=>JSON.stringify(e))))}catch(e){throw console.error("Error calling Flutter handler:",e),e}return null},u=e=>{let t=document.createElement("img");return t.id="question-result-mark",t.src=e,t.className="question-is-correct-mark",t.style.width="60px",t.style.height="60px",t.style.margin="0px",t},d=e=>null!=e?e.replace(/\$\$(.*?)\$\$|\$(.*?)\$/g,(e,t,n)=>{let i=e.startsWith("$$");try{return o.Z.renderToString(t||n,{displayMode:i,throwOnError:!1,macros:{"\\frac":"\\dfrac"}})}catch(e){return console.error("LaTeX rendering error:",e),'<span style="color: red;">[LaTeX Error: '.concat(e instanceof Error?e.message:String(e),"]</span>")}}):e,h=()=>{(0,a.A)("Some features limited due to network restrictions. This is the CES version of Chalk",{duration:3e3,id:"develop"})}},66648:function(e,t,n){"use strict";n.d(t,{default:function(){return i.a}});var o=n(55601),i=n.n(o)},55601:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return l},getImageProps:function(){return r}});let o=n(99920),i=n(80497),s=n(38173),a=o._(n(21241));function r(e){let{props:t}=(0,i.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let l=s.Image},48034:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});var o=n(63090);class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}addEvent(e){o.k.info("[EventStore] Adding event:",e),this.isReady?this.callbacks.forEach(t=>t(e)):this.eventQueue.push(e)}setReady(){this.isReady=!0,this.processQueue()}onEvent(e){this.callbacks.push(e)}processQueue(){for(;this.eventQueue.length>0;){let e=this.eventQueue.shift();e&&this.callbacks.forEach(t=>t(e))}}constructor(){this.eventQueue=[],this.isReady=!1,this.callbacks=[]}}let s=i.getInstance()},56106:function(e,t,n){"use strict";var o,i;n.d(t,{Q:function(){return o}}),(i=o||(o={})).FTOW_EVENT_NAME="flutterEvent",i.FTOW_DRAW_QUESTION="DRAW_QUESTION",i.FTOW_SELECT_ANSWER="SELECT_ANSWER",i.FTOW_QUESTION_LIST="QUESTION_PREVIEW_LIST",i.FTOW_RESULT_LIST="RESULT_PREVIEW_LIST",i.FTOW_CHAT_INPUT="CHAT_INPUT",i.WTOF_GENERATE_BUTTONS="GENERATE_BUTTONS",i.WTOF_PAGE_HEIGHT="PAGE_HEIGHT",i.WTOF_HIGHLIGHT="HIGHLIGHT",i.FTOW_CLINIC_DATA="FTOW_CLINIC_DATA",i.FTOW_CLINIC_DE_DATA="FTOW_CLINIC_DE_DATA",i.WTOF_CLINIC_TYPE_CHANGE="CLINIC_TYPE_CHANGE",i.WTOF_REQUEST_DE_DATA="REQUEST_DE_DATA",i.WTOF_REQUEST_KEYWORD="REQUEST_KEYWORD",i.FTOW_KEYWORD_DATA="KEYWORD_DATA",i.FTOW_CLINICK="CILINIC_INIT",i.WTOF_CLINICK_HIGHLIGHT="CLINIC_HIGHLIGHT",i.FTOW_EXPLAIN="EXPLAIN",i.FTOW_DRAW_QUIZ="DRAW_QUIZ",i.FTOW_CHECK_QUIZ="CHECK_QUIZ",i.WTOF_RESULT_QUIZ="RESULT_QUIZ",i.WTOF_CHAT_VIDEO_CLICK="CHAT_VIDEO_CLICK",i.FTOW_TEACHER_ID="TEACHER_ID",i.CTOF_CLINIC_HIGHTLIGHT="CLINIC_HIGHLIGHT_FOR_FLUTTER",i.FTOW_QUIZ_ANSWER="QUIZ_INPUT",i.CTOF_CLINIC_EVENT_RESPOONSE="CLINIC_EVENT_RESPOONSE_FOR_FLUTTER",i.FTOW_CLINIC_START_MIDLE_QUESTION="CLINIC_START_MIDLE_QUESTION",i.WTOF_CONVERT_TEXT_REQUEST="CONVERT_TEXT_REQUEST",i.FTOW_CONVERT_TEXT_RESPONSE="CONVERT_TEXT_RESPONSE",i.FTOW_CLINIC_USER_FEEDBACK_MESSAGE="CLINIC_USER_FEEDBACK_MESSAGE",i.FTOW_CLINIC_INITIAL_LOADING="CLINIC_INITIAL_LOADING"},22784:function(e,t,n){"use strict";var o=n(2265),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=o.useState,a=o.useEffect,r=o.useLayoutEffect,l=o.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),o=s({inst:{value:n,getSnapshot:t}}),i=o[0].inst,u=o[1];return r(function(){i.value=n,i.getSnapshot=t,c(i)&&u({inst:i})},[e,n,t]),a(function(){return c(i)&&u({inst:i}),e(function(){c(i)&&u({inst:i})})},[e]),l(n),n};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},94207:function(e,t,n){"use strict";var o=n(2265),i=n(29866),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=i.useSyncExternalStore,r=o.useRef,l=o.useEffect,c=o.useMemo,u=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,o,i){var d=r(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;var m=a(e,(d=c(function(){function e(e){if(!l){if(l=!0,a=e,e=o(e),void 0!==i&&h.hasValue){var t=h.value;if(i(t,e))return r=t}return r=e}if(t=r,s(a,e))return t;var n=o(e);return void 0!==i&&i(t,n)?t:(a=e,r=n)}var a,r,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,o,i]))[0],d[1]);return l(function(){h.hasValue=!0,h.value=m},[m]),u(m),m}},29866:function(e,t,n){"use strict";e.exports=n(22784)},30794:function(e,t,n){"use strict";e.exports=n(94207)}},function(e){e.O(0,[5864,3954,1351,4868,8173,2971,7023,1744],function(){return e(e.s=1090)}),_N_E=e.O()}]);
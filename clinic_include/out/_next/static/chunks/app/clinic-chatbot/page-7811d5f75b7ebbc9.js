(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1103],{44415:function(e,t,n){var o={"./QUS0000000324.json":[74522,4522],"./QUS0000000327.json":[811,811],"./QUS0000000328.json":[83869,3869],"./QUS0000000329.json":[4926,4926],"./QUS0000000330.json":[1197,1197],"./QUS0000000331.json":[21960,1960],"./QUS0000000332.json":[87037,7037],"./QUS0000000338.json":[89811,9811],"./QUS0000000339.json":[97068,7068],"./QUS0000000340.json":[94201,8209],"./QUS0000000341.json":[33850,3850],"./QUS0000000344.json":[84201,4201],"./QUS0000000345.json":[40869,869],"./QUS0000000346.json":[90766,766],"./QUS0000000347.json":[94204,4204],"./QUS0000000348.json":[21163,1163],"./QUS0000000349.json":[37697,7697],"./QUS0000000350.json":[88042,8042],"./QUS0000000351.json":[52160,2160],"./QUS0000000352.json":[9987,9987],"./QUS0000000353.json":[22765,2765],"./QUS0000000354.json":[49268,9268],"./QUS0000000355.json":[27864,7864],"./QUS0000000356.json":[7025,7025],"./QUS0000000383.json":[49434,9434],"./QUS0000000393.json":[65516,5516],"./QUS0000000395.json":[10652,652],"./QUS0000000396.json":[17738,7738],"./QUS0000000399.json":[10922,922],"./QUS0000000402.json":[42443,2443],"./QUS0000000403.json":[52105,2105],"./QUS0000000404.json":[49974,9974],"./QUS0000000412.json":[32086,2086],"./QUS0000000413.json":[25563,5563],"./QUS0000000414.json":[3370,3370],"./QUS0000000417.json":[44095,4095],"./QUS0000000419.json":[87247,7247],"./QUS0000000420.json":[28421,8421],"./QUS0000000423.json":[46095,6095],"./QUS0000000424.json":[33109,3109],"./QUS0000000425.json":[39854,9854],"./QUS0000000446.json":[29312,9312],"./QUS0000000447.json":[36837,6837],"./QUS0000000448.json":[55177,5177],"./QUS0000000450.json":[17503,7503],"./QUS0000000452.json":[32825,2825],"./QUS0000000453.json":[46615,6615],"./QUS0000000455.json":[61536,1536],"./QUS0000000456.json":[23532,3532],"./QUS0000000465.json":[18106,8106],"./QUS0000000466.json":[16684,6684],"./QUS0000000469.json":[75978,5978],"./QUS0000000470.json":[75186,5186],"./QUS0000000471.json":[33261,3261],"./QUS0000000473.json":[84190,4190],"./QUS0000000474.json":[44481,4481],"./QUS0000000475.json":[86351,6351],"./QUS0000000476.json":[63415,3415],"./QUS0000000478.json":[92548,2548],"./QUS0000000480.json":[93687,3687],"./QUS0000000481.json":[82273,2273],"./QUS0000000493.json":[25094,5094],"./QUS0000000498.json":[43910,3910],"./QUS0000000501.json":[53904,3904],"./QUS0000000504.json":[6313,6313],"./QUS0000000509.json":[6468,6468],"./QUS0000000510.json":[3297,3297],"./QUS0000000511.json":[43149,3149],"./QUS0000000525.json":[49502,9502],"./QUS0000000538.json":[61763,1763],"./QUS0000000540.json":[59677,9677],"./QUS0000000589.json":[5321,5321],"./QUS0000000590.json":[83767,3767],"./QUS0000000617.json":[74744,4744],"./QUS0000000631.json":[1601,1601],"./QUS0000000632.json":[28988,8988],"./QUS0000000633.json":[6194,6194],"./QUS0000000636.json":[70354,354],"./QUS0000000640.json":[53431,3431],"./QUS0000000641.json":[20692,692],"./QUS0000000657.json":[26514,6514],"./QUS0000000666.json":[14874,4874],"./QUS0000000668.json":[24209,4209],"./QUS0000000669.json":[99361,9361],"./QUS0000000676.json":[53918,3918],"./QUS0000000679.json":[8212,8212],"./QUS0000000682.json":[10200,200],"./QUS0000000690.json":[57090,7090],"./QUS0000000691.json":[11550,1550],"./QUS0000000692.json":[21986,1986],"./QUS0000000706.json":[13325,3325],"./QUS0000000712.json":[19851,9851],"./QUS0000000735.json":[10358,358],"./QUS0000000746.json":[72072,2072],"./QUS0000000747.json":[32111,2111],"./QUS0000000748.json":[29727,9727]};function i(e){if(!n.o(o,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=o[e],i=t[0];return n.e(t[1]).then(function(){return n.t(i,19)})}i.keys=function(){return Object.keys(o)},i.id=44415,e.exports=i},86869:function(e,t,n){Promise.resolve().then(n.bind(n,91494))},91494:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var o=n(57437),i=n(2265),a=n(63090);let s=[{text:"Do you understand everything so far?",audioPath:e=>"assets/clinic/common-AN-".concat(e,".mp3")},{text:"If you're still unsure, try reading the problem again.",audioPath:e=>"assets/clinic/common-random_1-".concat(e,".mp3")},{text:"Then, read the problem again and check the given conditions.",audioPath:e=>"assets/clinic/common-random_2-".concat(e,".mp3")},{text:"Let's read again to see what the question is asking.",audioPath:e=>"assets/clinic/common-random_3-".concat(e,".mp3")},{text:"Shall we go over the key information in the problem again?",audioPath:e=>"assets/clinic/common-random_4-".concat(e,".mp3")},{text:"Look at the problem once more and check if you missed anything.",audioPath:e=>"assets/clinic/common-random_5-".concat(e,".mp3")},{text:"To better understand the problem, review the key terms again.",audioPath:e=>"assets/clinic/common-random_6-".concat(e,".mp3")},{text:"Think about how the information above might be used in the next question.",audioPath:e=>"assets/clinic/common-random_7-".concat(e,".mp3")},{text:"Now, let's look at the next question and review each part of the problem again.",audioPath:e=>"assets/clinic/common-random_8-".concat(e,".mp3")},{text:"Try reading the problem more slowly and think about it again.",audioPath:e=>"assets/clinic/common-random_9-".concat(e,".mp3")},{text:"Then, read the problem slowly again and think about the main point one more time.",audioPath:e=>"assets/clinic/common-random_10-".concat(e,".mp3")},{text:"Which part are you unsure about?",audioPath:e=>"assets/clinic/common-ST-".concat(e,".mp3")},{text:"Is there anything that you're unsure about?",audioPath:e=>"assets/clinic/common-group-".concat(e,".mp3")},{text:"then take a look at this",audioPath:e=>"assets/clinic/common-keyword-".concat(e,".mp3")},{text:"this vidoe should help you understand better",audioPath:e=>"assets/clinic/common-video-".concat(e,".mp3")},{text:"I'm sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",audioPath:e=>"assets/clinic/common-zilmun-".concat(e,".mp3")},{text:"Sorry, I didn't fully understand. Could you clarify a bit more, or should I start from the beginning?",audioPath:e=>"assets/clinic/common-sorry-".concat(e,".mp3")},{text:"It might not make sense at first, and that's okay. Let's tackle the problem step by step together.",audioPath:e=>"assets/clinic/common-ST-cusion-1-".concat(e,".mp3")},{text:"Having trouble understanding? No worries—I'll guide you through it. Let's dive in!",audioPath:e=>"assets/clinic/common-ST-cusion-2-".concat(e,".mp3")},{text:"Starting can feel tough sometimes, and that's completely normal. Let's break it down one step at a time.",audioPath:e=>"assets/clinic/common-ST-cusion-3-".concat(e,".mp3")},{text:"If the problem feels overwhelming, don't worry—I'll lead the way. Let's work through it together!",audioPath:e=>"assets/clinic/common-ST-cusion-4-".concat(e,".mp3")},{text:"Still finding it tricky? That's okay. Let's take it slow and steady from here.",audioPath:e=>"assets/clinic/common-ST-cusion-5-".concat(e,".mp3")},{text:"Does it seem a little complicated? No problem—let's take our time and work through it step by step.",audioPath:e=>"assets/clinic/common-ST-cusion-6-".concat(e,".mp3")},{text:"Not quite sure about it yet? Don't worry—I'll walk you through the process. Let's begin!",audioPath:e=>"assets/clinic/common-ST-cusion-7-".concat(e,".mp3")},{text:"Was solving the problem more challenging than expected? I'm here to help you figure it out!",audioPath:e=>"assets/clinic/common-ST-cusion-8-".concat(e,".mp3")},{text:"It might not be easy right away, but that's okay. Let's work through it together now.",audioPath:e=>"assets/clinic/common-ST-cusion-9-".concat(e,".mp3")},{text:"Did it feel a bit tough? No need to worry—I'll help you every step of the way!",audioPath:e=>"assets/clinic/common-ST-cusion-10-".concat(e,".mp3")},{text:"Then take a look at this.",audioPath:e=>"assets/clinic/common-keyword-0-".concat(e,".mp3")},{text:"This explanation might help you",audioPath:e=>"assets/clinic/common-keyword-1-".concat(e,".mp3")},{text:"This should be helpful.",audioPath:e=>"assets/clinic/common-keyword-2-".concat(e,".mp3")},{text:"Why don't you take a look at this?",audioPath:e=>"assets/clinic/common-keyword-3-".concat(e,".mp3")},{text:"Reading this could be helpful.",audioPath:e=>"assets/clinic/common-keyword-4-".concat(e,".mp3")},{text:"Did my explanation help clear any of your confusions?",audioPath:e=>"assets/clinic/common-After_keyword_1-".concat(e,".mp3")},{text:"Did my explanation help you feel more comfortable with these type of problems?",audioPath:e=>"assets/clinic/common-After_keyword_2-".concat(e,".mp3")},{text:"Did I help clear all of your previous misunderstandings?",audioPath:e=>"assets/clinic/common-After_keyword_3-".concat(e,".mp3")},{text:"Are you confident enough to do these on your own?",audioPath:e=>"assets/clinic/common-After_keyword_4-".concat(e,".mp3")},{text:"Are you confident enough to think through these steps on your own?",audioPath:e=>"assets/clinic/common-After_keyword_5-".concat(e,".mp3")},{text:"If my explanation did not cover all of your questions, I can recommend you to one of my lectures.",audioPath:e=>"assets/clinic/common-After_keyword_6-".concat(e,".mp3")},{text:"If you are unsure, I have just the right lecture for you.",audioPath:e=>"assets/clinic/common-After_keyword_7-".concat(e,".mp3")},{text:"If you want to know more clearly, I'll cover it in detail with a lecture. How does that sound?",audioPath:e=>"assets/clinic/common-After_keyword_8-".concat(e,".mp3")},{text:"Lets review any parts we did not cover with a lecture.",audioPath:e=>"assets/clinic/common-After_keyword_9-".concat(e,".mp3")},{text:"If you need an simplified explanation, lets take a look at the quick lecture.",audioPath:e=>"assets/clinic/common-After_keyword_10-".concat(e,".mp3")},{text:"Don't worry! After watching the lectures, things will make much more sense.",audioPath:e=>"assets/clinic/common-before_Lecture_1-".concat(e,".mp3")},{text:"Feeling stuck right now is normal. Watching the lectures again will help clarify everything.",audioPath:e=>"assets/clinic/common-before_Lecture_2-".concat(e,".mp3")},{text:"It's okay if it's not clear yet. We'll take it step by step as we go through the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_3-".concat(e,".mp3")},{text:"No need to stress if you're confused right now. The lectures will make it easier to grasp.",audioPath:e=>"assets/clinic/common-before_Lecture_4-".concat(e,".mp3")},{text:"It might seem tricky at first, but it'll feel much simpler once you review the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_5-".concat(e,".mp3")},{text:"This is an important concept for moving forward. Let's study it together with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_6-".concat(e,".mp3")},{text:"The concept we just covered is essential. Let's explore it further with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_7-".concat(e,".mp3")},{text:"Understanding this concept is key to solving problems. Let's take the time to master it with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_8-".concat(e,".mp3")},{text:"What I just explained is a critical point. Let's dive deeper into it by watching the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_9-".concat(e,".mp3")},{text:"Truly understanding this concept is vital for tackling the problem. Let's break it down with the lectures.",audioPath:e=>"assets/clinic/common-before_Lecture_10-".concat(e,".mp3")},{text:"Sorry, I didn't fully understand. Could you clarify a bit more, or should I start from the beginning?",audioPath:e=>"assets/clinic/common-sorry-".concat(e,".mp3")},{text:"I'm sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",audioPath:e=>"assets/clinic/common-zilmun-".concat(e,".mp3")},{text:"The clinic has ended. Now, try solving the problem again.",audioPath:e=>"assets/clinic/common-END-".concat(e,".mp3")}],l=(e,t)=>{if(!t)return null;let n=s.find(t=>t.text===e);return console.log("\uD83D\uDD35 [getAudioPath] mapping",n),console.log("\uD83D\uDD35 [getAudioPath] audioPath",null==n?void 0:n.audioPath(t)),n?n.audioPath(t):null},r=e=>null!==e&&"highlight_set"in e,c=()=>{let[e,t]=(0,i.useState)([]),[n,o]=(0,i.useState)(!1),s=async e=>new Promise(n=>{t(t=>{let o=[...t,e];return n(),o})});return{messages:e,streamText:async e=>{let{isOnlyText:t,text:n,message:o,teacherCode:i,hasChoiceButtons:c,clipSet:d,isMiddleQuestion:u=!1,audioURL:h}=e;if(t){let e={text:n,sender:"bot",timestamp:new Date().toLocaleTimeString(),hasChoiceButtons:c,clip_set:d||null,audio:l(n,i),audioURL:h||null,highlight_set:r(o)?o.highlight_set:null,isMiddleQuestion:u};await s(e),a.k.info("[streamText 1] newMessage",e)}else if(o){var m;let e=o.variations.filter(e=>e.teacher_code===i);if(!e.length){a.k.info("No matching variations found for teacher_code:",i),s({text:o.content,sender:"bot",timestamp:new Date().toLocaleTimeString(),audio:null,audioURL:null,hasChoiceButtons:c,clip_set:null,highlight_set:null,isMiddleQuestion:u});return}let t=e[Math.floor(Math.random()*e.length)],n={text:null!==(m=null==t?void 0:t.variation_content)&&void 0!==m?m:o.content,sender:"bot",timestamp:new Date().toLocaleTimeString(),audio:(null==t?void 0:t.tts)?"".concat(t.tts):null,audioURL:null,hasChoiceButtons:c,clip_set:d||null,highlight_set:r(o)?o.highlight_set:null,isMiddleQuestion:u};s(n),a.k.info("[streamText 2] newMessage",n)}},addMessage:s}};var d=n(48388),u=function(e,t,n){for(var o=n,i=0,a=e.length;o<t.length;){var s=t[o];if(i<=0&&t.slice(o,o+a)===e)return o;"\\"===s?o++:"{"===s?i++:"}"===s&&i--,o++}return -1},h=/^\\begin{/,m=function(e,t){for(var n,o=[],i=RegExp("("+t.map(e=>e.left.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")).join("|")+")");-1!==(n=e.search(i));){n>0&&(o.push({type:"text",data:e.slice(0,n)}),e=e.slice(n));var a=t.findIndex(t=>e.startsWith(t.left));if(-1===(n=u(t[a].right,e,t[a].left.length)))break;var s=e.slice(0,n+t[a].right.length),l=h.test(s)?s:e.slice(t[a].left.length,n);o.push({type:"math",data:l,rawData:s,display:t[a].display}),e=e.slice(n+t[a].right.length)}return""!==e&&o.push({type:"text",data:e}),o},g=function(e,t){var n=m(e,t.delimiters);if(1===n.length&&"text"===n[0].type)return null;for(var o=document.createDocumentFragment(),i=0;i<n.length;i++)if("text"===n[i].type)o.appendChild(document.createTextNode(n[i].data));else{var a=document.createElement("span"),s=n[i].data;t.displayMode=n[i].display;try{t.preProcess&&(s=t.preProcess(s)),d.Z.render(s,a,t)}catch(e){if(!(e instanceof d.Z.ParseError))throw e;t.errorCallback("KaTeX auto-render: Failed to parse `"+n[i].data+"` with ",e),o.appendChild(document.createTextNode(n[i].rawData));continue}o.appendChild(a)}return o},p=function e(t,n){for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];if(3===i.nodeType){for(var a=i.textContent,s=i.nextSibling,l=0;s&&s.nodeType===Node.TEXT_NODE;)a+=s.textContent,s=s.nextSibling,l++;var r=g(a,n);if(r){for(var c=0;c<l;c++)i.nextSibling.remove();o+=r.childNodes.length-1,t.replaceChild(r,i)}else o+=l}else 1===i.nodeType&&function(){var t=" "+i.className+" ";-1===n.ignoredTags.indexOf(i.nodeName.toLowerCase())&&n.ignoredClasses.every(e=>-1===t.indexOf(" "+e+" "))&&e(i,n)}()}},f=function(e,t){if(!e)throw Error("No element provided to render");var n={};for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);n.delimiters=n.delimiters||[{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\begin{equation}",right:"\\end{equation}",display:!0},{left:"\\begin{align}",right:"\\end{align}",display:!0},{left:"\\begin{alignat}",right:"\\end{alignat}",display:!0},{left:"\\begin{gather}",right:"\\end{gather}",display:!0},{left:"\\begin{CD}",right:"\\end{CD}",display:!0},{left:"\\[",right:"\\]",display:!0}],n.ignoredTags=n.ignoredTags||["script","noscript","style","textarea","pre","code","option"],n.ignoredClasses=n.ignoredClasses||[],n.errorCallback=n.errorCallback||console.error,n.macros=n.macros||{},p(e,n)};n(7395);let x=e=>e,y=e=>{let{content:t,className:n,style:a,useProcessor:s=!1,onLoad:l}=e,r=(0,i.useRef)(null);return(0,i.useEffect)(()=>{null==l||l()},[l]),(0,i.useEffect)(()=>{if(r.current){let e=s?x(t):t;r.current.innerHTML=e,s||f(r.current,{delimiters:[{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"$$",right:"$$",display:!0}],throwOnError:!1,macros:{"\\frac":"\\dfrac"}})}},[t,s]),(0,o.jsx)("div",{ref:r,className:n,style:a})};var C=n(37440),w=n(56106);let T=(0,i.forwardRef)((e,t)=>{let{text:n,visibleMessages:a,onComplete:s,index:l}=e,[r,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)(!1);(0,i.useImperativeHandle)(t,()=>({completeTyping:()=>{c(n),u(!1),null==s||s()}}));let g=(0,i.useCallback)(()=>{c(n),m(!0)},[n]);return(0,i.useEffect)(()=>{a.length-1===l?(u(!0),c(""),m(!1)):g()},[l,a.length,g]),(0,i.useEffect)(()=>{if(d&&!h){if(r.length<n.length){let e=setTimeout(()=>{let e=r.length+1;if("$"===n[r.length]){let t=n.indexOf("$",r.length+1);-1!==t&&(e=t+1)}c(n.slice(0,e))},10);return()=>clearTimeout(e)}m(!0),a.length-1===l&&(null==s||s())}},[r.length,h,s,n,d,l,a.length]),(0,o.jsx)(y,{content:r+(h?"":" ")})});T.displayName="TypingBotMessage";let S=e=>{let{audioUrl:t,index:n,onComplete:i,setAudioRef:a}=e;return(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsxs)("audio",{ref:e=>a(e,n),controls:!0,className:"w-full max-w-[300px]",onEnded:()=>i(n),onError:e=>console.error("\uD83D\uDD0A [AudioPlayer] Error:",e),children:[(0,o.jsx)("source",{src:t,type:"audio/mp3"}),"Your browser does not support the audio element."]})})};var E=n(66648);let k=e=>{let{clips:t,onVodClick:n}=e;return(0,o.jsx)("div",{"data-no-skip":"true",className:"overflow-x-auto w-full",children:(0,o.jsx)("div",{className:"inline-flex gap-4 pb-4",children:t.map((e,t)=>(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("div",{className:"flex flex-row gap-4",children:e.lecture_vod_set.map((t,i)=>t.thumbnail_url&&(0,o.jsx)("div",{className:"flex flex-col",children:(0,o.jsxs)("div",{className:"cursor-pointer hover:opacity-80 transition-opacity relative w-[280px]",onClick:()=>n(e.code),children:[(0,o.jsxs)("div",{className:"relative bg-black rounded-lg",children:[(0,o.jsx)(E.default,{src:"".concat(t.thumbnail_url),alt:"".concat(t.title," thumbnail"),className:"w-full h-auto rounded-lg opacity-30",width:280,height:180}),(0,o.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,o.jsx)(E.default,{src:"/assets/images/icon_play.svg",alt:"play",className:"w-8 h-8",width:32,height:32})})]}),(0,o.jsx)("div",{className:"font-bold text-black mb-2 mt-2",children:t.title})]})},i))})},t))})})},D=e=>{let{sender:t,hasClipSet:n}=e,o="pl-[16px] py-[10px] rounded-[8px]";return"user"===t?"".concat(o," bg-[#F3F3F3] max-w-[85%] px-[16px]"):n?"".concat(o," w-full"):"".concat(o," max-w-[85%]")},N=e=>{let{sender:t}=e;return"flex flex-col ".concat("user"===t?"justify-end":"justify-start"," mt-[10px] mb-[12px]")},_=e=>{let{sender:t}=e;return"flex items-center ".concat("user"===t?"justify-end":"")},v=e=>({opacity:e?1:0,transition:"opacity 0.3s ease-in-out",height:e?"auto":0,overflow:"hidden"}),b=e=>{let t=e.match(/<img[^>]*>/);if(!t)return{text:e,imageHtml:null};let n=t[0].replace(/<img/,'<img class="w-full h-auto max-h-[140px] object-contain"');return{text:e.replace(/<img[^>]*>/,"").trim(),imageHtml:n}},I=e=>{let{messages:t,children:n,onShowNext:s,onMessageComplete:l}=e,r=(0,i.useRef)([]),[c,d]=(0,i.useState)([]),[u,h]=(0,i.useState)(null),m=(0,i.useRef)(null),g=(0,i.useRef)([]),p=(0,i.useCallback)((e,t)=>{r.current[t]=e},[]),f=(0,i.useCallback)(()=>{if(null!==u){let e=r.current[u];e&&(e.pause(),e.currentTime=0,h(null))}},[u]),x=(0,i.useCallback)(e=>{let t=r.current[e];t&&(t.play().catch(e=>{a.k.info("[MessageList] Audio playback failed:",e),h(null)}),h(e),t.addEventListener("ended",()=>{h(null),F(e)},{once:!0}))},[]),E=()=>{var e;let t=null===(e=m.current)||void 0===e?void 0:e.closest(".overflow-y-auto");if(t){let e=t.scrollHeight-t.scrollTop===t.clientHeight;if(t.scrollTo({top:t.scrollHeight,behavior:"smooth"}),e){let e=document.querySelector(".clinic-chat-container");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}}},I=(0,i.useCallback)(()=>{setTimeout(()=>{E()},100)},[]),j=(0,i.useCallback)(e=>{d(t=>Array.from(new Set([...t,e])).sort((e,t)=>e-t)),I()},[I]);(0,i.useEffect)(()=>{if(t.length>0){let e=t.length-1,n=t[e];a.k.info("[MessageList useEffect] Current state:",{lastMessageIndex:e,lastMessage:n,currentPlayingIndex:u,visibleMessages:c,isMiddleQuestion:n.isMiddleQuestion,hasAudio:!!(n.audio||n.audioURL),shouldShow:R(e,n)}),n.isMiddleQuestion&&u!==e&&n.audio&&(console.log("[MessageList useEffect] Middle question handling:",e),f()),!c.includes(e)&&R(e,n)&&(console.log("[MessageList useEffect] Message display handling:",{action:"showing message and playing audio",hasAudio:!!n.audio,isMiddleQuestion:n.isMiddleQuestion,currentPlayingIndex:u}),j(e),(0,C.dz)(w.Q.CTOF_CLINIC_HIGHTLIGHT,{highlight_set:n.highlight_set}),(n.audio||n.audioURL)&&u!==e&&(console.log("[MessageList useEffect] Audio handling:",{action:"playing new audio",messageIndex:e,currentPlayingIndex:u,audioSource:n.audio?"audio":"audioURL"}),f(),x(e)))}},[t,u,c,f,x,j]),(0,i.useEffect)(()=>{t.length>0&&!c.includes(0)&&d([0])},[t,c]);let Q=(0,i.useCallback)(e=>{let n=e+1;if(!c.includes(n)){if(a.k.info("[showNextMessage] Start",{currentIndex:e,currentPlayingIndex:u,messagesLength:t.length,visibleMessages:c}),null!==u){let e=r.current[u];e&&(a.k.info("[showNextMessage] Stopping current audio",u),e.pause(),e.currentTime=0)}a.k.info("[showNextMessage] Calculating next index",{nextIndex:n,hasNextMessage:n<t.length,nextMessage:n<t.length?t[n]:null}),n<t.length&&(d(e=>{let t=Array.from(new Set([...e,n])).sort((e,t)=>e-t);return a.k.info("[showNextMessage] New visible messages state:",t),t}),setTimeout(()=>{E()},100))}},[u,t.length,t,c]),U=e=>{let n=r.current[e],o=t[e];n&&(o.audio||o.audioURL)&&(n.play().catch(e=>{console.log("\uD83D\uDD35 [Audio playback failed] error",e),h(null)}),h(e),n.addEventListener("ended",()=>{h(null),F(e)}))},O=e=>{let t=c[c.length-1],n=e===t;return n&&console.log("[isLastVisibleMessage]",{index:e,lastVisibleIndex:t,visibleMessages:c,result:n}),n};(0,i.useEffect)(()=>{s&&s(Q)},[s,Q]);let F=e=>{if(null!==u&&u!==e)return;a.k.info("[handleMessageComplete] Start",{index:e,currentPlayingIndex:u,visibleMessages:c});let n=e+1;l&&l(e),(async()=>{if(null!==u){let e=r.current[u];e&&(e.pause(),e.currentTime=0)}if(n<t.length&&!c.includes(n)&&(await new Promise(e=>setTimeout(e,500)),Q(e)),n<t.length&&(t[n].audio||t[n].audioURL)){h(n);let e=r.current[n];if(e)try{await e.play()}catch(e){a.k.info("[MessageList] Next audio playback failed:",e),h(null)}}else h(null)})()},L=e=>{a.k.info("Selected lecture code:",e),(0,C.dz)(w.Q.WTOF_CHAT_VIDEO_CLICK,e)};(0,i.useEffect)(()=>{var e,n;t.length>0&&0===c.length&&((null===(e=t[0])||void 0===e?void 0:e.audio)||(null===(n=t[0])||void 0===n?void 0:n.audioURL))&&r.current[0]&&(r.current[0].play().catch(e=>{a.k.info("[MessageList] Auto-play failed:",e)}),h(0))},[t,c.length]),(0,i.useEffect)(()=>{let e=c[c.length-1];if(void 0!==e){let n=t[e];(null==n?void 0:n.sender)==="bot"&&(0,C.dz)(w.Q.CTOF_CLINIC_HIGHTLIGHT,{highlight_set:n.highlight_set})}},[c,t]);let R=(e,n)=>{let o={isFirstMessage:0===e,isUserMessage:"user"===n.sender,isMiddleQuestion:n.isMiddleQuestion,hasPreviousUserMessage:e>0&&"user"===t[e-1].sender,isPreviousMessageVisible:e>0&&c.includes(e-1),isCurrentMessageNotVisible:!c.includes(e),isBotMessage:"bot"===n.sender};if(console.log("[shouldShowMessage] Checking conditions",{index:e,message:n,conditions:o,currentPlayingIndex:u}),o.isFirstMessage||o.isUserMessage||o.isMiddleQuestion||o.hasPreviousUserMessage)return!0;if(o.isPreviousMessageVisible&&o.isCurrentMessageNotVisible&&o.isBotMessage){let n=t[e-1],o=!!(n.audio||n.audioURL),i=!o||u!==e-1;return a.k.info("[shouldShowMessage] Checking audio conditions",{index:e,prevMessage:n,currentPlayingIndex:u,hasAudio:o,shouldShow:i}),i}return!1};return(0,o.jsx)("div",{className:"bg-white rounded-lg h-[calc(100%-60px)] flex flex-col",onClick:e=>{if(!e.target.closest('[data-no-skip="true"]')&&null!==u){t.forEach((e,t)=>{var n;null===(n=g.current[t])||void 0===n||n.completeTyping()});let e=t[u];if(e.audio||e.audioURL){let e=r.current[u];e&&(e.pause(),e.currentTime=0)}F(u);let n=u+1;n<t.length&&(t[n].audio||t[n].audioURL)&&U(n)}},children:(0,o.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,o.jsxs)("div",{className:"p-4",children:[t.map((e,i)=>{let{text:s,imageHtml:l}=b(e.text);return(0,o.jsxs)("div",{className:N({sender:e.sender}),style:v(c.includes(i)),children:[(0,o.jsx)("div",{className:_({sender:e.sender}),children:(0,o.jsxs)("div",{className:D({sender:e.sender,hasClipSet:!!e.clip_set}),children:[l&&(0,o.jsxs)("div",{className:"mb-2 relative flex justify-start items-center h-[140px]",children:[(0,o.jsx)("div",{className:"transition-all duration-300 ".concat(c.includes(i)?"opacity-100 translate-y-0":"opacity-0 translate-y-4"),children:(0,o.jsx)("div",{className:"flex justify-start",dangerouslySetInnerHTML:{__html:l.replace(/<img/,'<img loading="eager" decoding="sync"')}})}),!c.includes(i)&&(0,o.jsx)("div",{className:"absolute inset-0 bg-gray-100 animate-pulse rounded"})]}),"user"===e.sender?(0,o.jsx)("div",{children:(0,o.jsx)(y,{content:e.text,onLoad:()=>{O(i)&&F(i)}})}):(0,o.jsx)(T,{ref:e=>g.current[i]=e,text:s,visibleMessages:c,onComplete:O(i)?()=>{a.k.info("[TypingBotMessage onComplete]",{index:i,visibleMessages:c,isLast:O(i),currentPlayingIndex:u,hasAudio:!!(e.audio||e.audioURL)}),(e.audio||e.audioURL)&&u===i||F(i)}:void 0,index:i}),e.clip_set&&(0,o.jsx)(k,{clips:e.clip_set,onVodClick:L}),(0,o.jsx)("div",{className:"flex flex-row w-full",children:(0,o.jsx)("div",{className:"w-full",style:{display:"none"},children:(e.audio||e.audioURL)&&(0,o.jsx)(S,{audioUrl:e.audioURL||e.audio||"",index:i,onComplete:F,setAudioRef:p})})})]})}),"bot"===e.sender&&i===t.length-1&&c.includes(i)&&e.hasChoiceButtons&&n]},i)}),(0,o.jsx)("div",{ref:m})]})})})},j=e=>{let{nodes:t,deResponseType:n,setChangeClinicType:i,setClinicType:s,setClinicDEData:l,streamText:r,addMessage:c,currentBNodeIndex:d,setCurrentBNodeIndex:u,structuredBNodes:h,currentGroupIndex:m,setCurrentGroupIndex:g,currentQuestion:p,resetQuestionInfo:f}=e,x=async(e,t,n)=>{switch(a.k.info("\uD83D\uDCF1 [handleUserResponse] Start from DEBNodeButtons:",{type:e,nodeCode:null==t?void 0:t.code,index:n}),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e){case"CLICK":if(!t||void 0===n)return;await T(t,n);break;case"YES":await S(!0);break;case"NO":await S(!1)}},T=async(e,t)=>{console.log("=== DEBNodeButtons handleClick ==="),console.log("Selected B Node:",e),console.log("Selected Index:",t),console.log("Current structuredBNodes:",h),a.k.info("\uD83D\uDCF1 [handleClick] Calling Flutter handler from DEBNodeButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await c({text:e.shortcut_content||"",sender:"user",timestamp:new Date().toLocaleTimeString()}),i(!1);try{let e=h[t];if(console.log("Selected Node with Children:",e),e.children){let n=Object.keys(e.children)[0];console.log("First Group Name:",n);let o=e.children[n];if(console.log("First Group Messages:",o),o.length>0){l(o),u(t);for(let e=0;e<o.length;e++)await r({isOnlyText:!1,text:"",message:o[e],teacherCode:p.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await r({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),console.log("Setting States - currentBNodeIndex:",t),i(!0),g(m+1)}}}catch(e){console.error("Failed to get next DE data:",e)}},S=async e=>{if(a.k.info("\uD83D\uDCF1 [handleUnderstandResponse] Calling Flutter handler from DEBNodeButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await c({text:e?"Yes, I know.":"No, I don't know.",sender:"user",timestamp:new Date().toLocaleTimeString()}),e){let e=h[d+1];if(a.k.info("✅ [handleUnderstandResponse] Yes path - Current Node:",{currentNode:e,currentBNodeIndex:d+1}),void 0===e)a.k.info("⚠️ [handleUnderstandResponse] Conversation ended - no more nodes"),f(),await r({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),s("END"),i(!0),await new Promise(e=>setTimeout(e,500));else if(!e.isVariationsShown){for(let t of(a.k.info("\uD83D\uDD04 [handleUnderstandResponse] Showing variations first time:",{nodeCode:e.code,variations:e.variations,teacherCode:p.teacherCode}),l([e]),[e]))a.k.info("\uD83D\uDCE4 [handleUnderstandResponse] Streaming variation message:",{messageCode:t.code,content:t.content,teacherCode:p.teacherCode}),await r({isOnlyText:!1,text:"",message:t,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});a.k.info("✏️ [handleUnderstandResponse] Marking variations as shown"),h[d+1]={...e,isVariationsShown:!0},u(d+1)}}else try{let e=h[d];console.log("node",e);let t=await new Promise(t=>{let n=e=>{let{type:o,data:i}=e.detail;o===w.Q.FTOW_CONVERT_TEXT_RESPONSE&&(window.removeEventListener(w.Q.FTOW_EVENT_NAME,n),t({text:i.text,textTTS:i.textTTS}))};window.addEventListener(w.Q.FTOW_EVENT_NAME,n),(0,C.dz)(w.Q.WTOF_CONVERT_TEXT_REQUEST,{text:e.content})});a.k.info("✅ [handleUnderstandResponse] Received converted text:",t),console.log("\uD83D\uDD35 [handleUnderstandResponse] Streaming converted text",t),null!==t.text&&await r({isOnlyText:!0,text:t.text,message:null,teacherCode:p.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1,audioURL:t.textTTS});let n=h[d];if(a.k.info("\uD83D\uDCCB [handleUnderstandResponse] Current Node:",{nodeCode:n.code,hasChildren:!!n.children,childrenGroups:n.children?Object.keys(n.children):[]}),n.children){let e=Object.keys(n.children)[0],t=n.children[e];for(let n of(a.k.info("\uD83D\uDD0D [handleUnderstandResponse] First group details:",{groupName:e,messageCount:t.length,teacherCode:p.teacherCode}),t))a.k.info("\uD83D\uDCE4 [handleUnderstandResponse] Streaming C-type message:",{messageCode:n.code,content:n.content}),await r({isOnlyText:!1,text:"",message:n,teacherCode:p.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),await new Promise(e=>setTimeout(e,100));await r({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:p.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("\uD83D\uDD04 [handleUnderstandResponse] Switching to C-type mode"),l(t),i(!0),g(1)}}catch(e){a.k.error("❌ [handleUnderstandResponse] Error:",e)}a.k.info("\uD83D\uDCF1 [handleUnderstandResponse] Calling Flutter handler:",{eventType:e})};return(0,o.jsx)("div",{className:"flex flex-col gap-2",children:n?(0,o.jsx)(o.Fragment,{children:t.map((e,t)=>(0,o.jsxs)("button",{onClick:()=>x("CLICK",e,t),className:"min-w-[100px] bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 text-sm rounded-[8px] text-left",children:[t+1,".",(0,o.jsx)(y,{content:e.shortcut_content||"",className:"text-gray-800"})]},e.code))}):(0,o.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,o.jsx)("button",{onClick:()=>x("YES"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"Yes, I know."}),(0,o.jsx)("button",{onClick:()=>x("NO"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"No, I don't know."})]})})},Q=["If you're still unsure, try reading the problem again.","Then, read the problem again and check the given conditions.","Let's read again to see what the question is asking.","Shall we go over the key information in the problem again?","Look at the problem once more and check if you missed anything.","To better understand the problem, review the key terms again.","Think about how the information above might be used in the next question.","Now, let's look at the next question and review each part of the problem again.","Try reading the problem more slowly and think about it again.","Then, read the problem slowly again and think about the main point one more time."],U=["It might not make sense at first, and that's okay. Let's tackle the problem step by step together.","Having trouble understanding? No worries—I'll guide you through it. Let's dive in!","Starting can feel tough sometimes, and that's completely normal. Let's break it down one step at a time.","If the problem feels overwhelming, don't worry—I'll lead the way. Let's work through it together!","Still finding it tricky? That's okay. Let's take it slow and steady from here.","Does it seem a little complicated? No problem—let's take our time and work through it step by step.","Not quite sure about it yet? Don't worry—I'll walk you through the process. Let's begin!","Was solving the problem more challenging than expected? I'm here to help you figure it out!","It might not be easy right away, but that's okay. Let's work through it together now.","Did it feel a bit tough? No need to worry—I'll help you every step of the way!"],O=["Then take a look at this.","This explanation might help you.","This should be helpful.","Why don't you take a look at this?","Reading this could be helpful."],F=["Did my explanation help clear any of your confusions?","Did my explanation help you feel more comfortable with these type of problems?","Did I help clear all of your previous misunderstandings?","Are you confident enough to do these on your own?","Are you confident enough to think through these steps on your own?","If my explanation did not cover all of your questions, I can recommend you to one of my lectures.","If you are unsure, I have just the right lecture for you.","If you want to know more clearly, I'll cover it in detail with a lecture. How does that sound?","Lets review any parts we did not cover with a lecture.","If you need an simplified explanation, lets take a look at the quick lecture."],L=["Don't worry! After watching the lectures, things will make much more sense.","Feeling stuck right now is normal. Watching the lectures again will help clarify everything.","It's okay if it's not clear yet. We'll take it step by step as we go through the lectures.","No need to stress if you're confused right now. The lectures will make it easier to grasp.","It might seem tricky at first, but it'll feel much simpler once you review the lectures.","This is an important concept for moving forward. Let's study it together with the lectures.","The concept we just covered is essential. Let's explore it further with the lectures.","Understanding this concept is key to solving problems. Let's take the time to master it with the lectures.","What I just explained is a critical point. Let's dive deeper into it by watching the lectures.","Truly understanding this concept is vital for tackling the problem. Let's break it down with the lectures."],R=e=>{let{nodes:t,setChangeClinicType:n,setDeResponseType:i,streamText:s,addMessage:l,setClinicDEData:r,currentBNodeIndex:c,setCurrentBNodeIndex:d,structuredBNodes:u,currentGroupIndex:h,setCurrentGroupIndex:m,currentQuestion:g,setClinicType:p,resetQuestionInfo:f}=e,x=e=>e?e.replace(/<img[^>]*>/g,"").replace(/<br\s*\/?>/g,"").replace(/<p>\s*<\/p>/g,""):"",T=async e=>{if(a.k.info("\uD83D\uDCF1 [handleClick] Calling Flutter handler from DECNodeButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await l({text:x(e.content||""),sender:"user",timestamp:new Date().toLocaleTimeString()}),e.keyword_set){console.log("handleClick - keyword_set",e);try{let t=O[Math.floor(Math.random()*O.length)];for(let o of(await s({isOnlyText:!0,text:t,message:null,teacherCode:g.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),e.keyword_set))o?(await s({isOnlyText:!1,text:"",message:e,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),r([{code:o.code,depth:"keyword",children:null,isVariationsShown:!1,highlight_set:[],keyword_set:[],option_set:[],variations:[],shortcut_content:null,option_type:"",order:0,group_name:null,clinic_type:"DE",type_index:0,parent:null,tag_set:[],content:o.content,clip_set:e.clip_set}]),n(!0)):await s({isOnlyText:!0,text:"키워드 데이터를 찾을 수 없어요.",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});let o=F[Math.floor(Math.random()*F.length)];await s({isOnlyText:!0,text:o,message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1})}catch(e){console.error("Failed to get keyword data:",e)}}},S=async()=>{try{console.log("=== DECNodeButtons handleContinue ==="),console.log("Current BNode Index:",c),console.log("Current Group Index:",h),a.k.info("\uD83D\uDCF1 [handleContinue] Calling Flutter handler from DECNodeButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await l({text:"Continue",sender:"user",timestamp:new Date().toLocaleTimeString()});let e=u[c];if(e.children){let t=Object.keys(e.children);a.k.info("Group Names:",t);let o=t[h];if(a.k.info("Next Group Name:",o),o){let t=e.children[o];for(let e of t)a.k.info("Streaming message:",e),await s({isOnlyText:!1,text:"",message:e,teacherCode:g.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await s({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),r(t),n(!0),m(h+1)}else if(c+1<u.length){let e=u[c+1];a.k.info("Streaming next node:",e),await s({isOnlyText:!1,text:"",message:e,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),i(!1),r([e]),n(!0),d(c+1),m(0)}else f(),await s({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:g.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),r([]),p("END"),n(!0),await new Promise(e=>setTimeout(e,500))}}catch(e){console.error("Failed to get next DE data:",e)}};return(0,o.jsxs)("div",{className:"flex flex-col gap-2",children:[t.map(e=>(0,o.jsx)("button",{onClick:()=>T(e),className:"min-w-[100px] bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 text-sm rounded-[8px] text-left",children:(0,o.jsx)(y,{content:x(e.content||""),className:"text-gray-800"})},e.code)),(0,o.jsx)("div",{className:"flex justify-start",children:(0,o.jsx)("button",{onClick:S,className:"bg-[#F3F3F3] flex flex-row gap-2 text-gray-800 px-4 py-2 items-center text-sm rounded-[8px] text-left",children:"Continue"})})]})},M=e=>{let{onUserResponse:t,showNextButton:n,currentQuestion:i}=e,s=async e=>{switch(a.k.info("\uD83D\uDCF1 [handleUserResponse] Start:",{type:e}),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e){case"YES":case"NEXT":t("AN",!0);break;case"NO":t("AN",!1)}};return(0,o.jsx)("div",{className:"flex gap-4",children:n?(0,o.jsx)("button",{onClick:()=>s("NEXT"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-[8px]",children:"Next"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:()=>s("YES"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-[8px]",children:"Yes"}),(0,o.jsx)("button",{onClick:()=>s("NO"),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-[8px]",children:"No"})]})})},P=e=>{let{getClinicData:t,currentQuestion:n,onUserResponse:i}=e,s=async()=>{a.k.info("\uD83D\uDCF1 [handleStartSolving] Calling Flutter handler from STClinicButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),i("ST",!0,"Yes, I was working on it")},l=async()=>{a.k.info("\uD83D\uDCF1 [handleNotStarted] Calling Flutter handler from STClinicButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),i("ST",!1,"I don’t know how to start")};return(0,o.jsxs)("div",{className:"flex gap-4",children:[(0,o.jsx)("button",{onClick:s,className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"Yes, I was working on it"}),(0,o.jsx)("button",{onClick:l,className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"I don’t know how to start"})]})},A=e=>{let{currentKeywordCode:t,setChangeClinicType:n,streamText:i,addMessage:s,onContinue:l,setClinicDEData:r,nodes:c,currentQuestion:d}=e,u=async e=>{let o={text:e?"I understand.":"I’m not quite sure.",sender:"user",timestamp:new Date().toLocaleTimeString()};if(await s(o),a.k.info("\uD83D\uDCF1 [handleUnderstand] Calling Flutter handler from DEKeywordNodeButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),e)l();else try{let e=L[Math.floor(Math.random()*L.length)];await i({isOnlyText:!0,text:e,message:null,teacherCode:d.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),await i({isOnlyText:!0,text:"",message:null,teacherCode:d.teacherCode,hasChoiceButtons:!0,clipSet:c[0].clip_set,isMiddleQuestion:!1}),r([{depth:"clip",code:t,children:null,isVariationsShown:!1,highlight_set:[],keyword_set:[],option_set:[],variations:[],shortcut_content:null,option_type:"",order:0,group_name:null,clinic_type:"DE",type_index:0,parent:null,tag_set:[],content:"",clip_set:c[0].clip_set}]),n(!0)}catch(e){console.error("Failed to get additional keyword data:",e)}};return(0,o.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,o.jsx)("button",{onClick:()=>u(!0),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"I understand."}),(0,o.jsx)("button",{onClick:()=>u(!1),className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"I’m not quite sure."})]})},B=e=>{let{addMessage:t,onContinue:n}=e,i=async()=>{a.k.info("\uD83D\uDCF1 [handleUnderstand] Calling Flutter handler from DEClipNodeButtons"),(0,C.dz)(w.Q.CTOF_CLINIC_EVENT_RESPOONSE,{count:1}),await t({text:"Continue",sender:"user",timestamp:new Date().toLocaleTimeString()}),await n()};return(0,o.jsx)("div",{className:"flex flex-row gap-2",children:(0,o.jsx)("button",{onClick:i,className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"Continue"})})},W=e=>{var t,n,s,l;let{messages:r,showNextMessage:c,clinicType:d,changeClinicType:u,deResponseType:h,setDeResponseType:m,currentBNodeIndex:g,setCurrentBNodeIndex:p,structuredBNodes:f,setStructuredBNodes:x,currentGroupIndex:y,setCurrentGroupIndex:C,addMessage:w,streamText:T,setClinicType:S,setChangeClinicType:E,setClinicData:k,showNextButton:D,setShowNextButton:N,middleQuestionStatus:_,initialize:v,getClinicData:b,currentQuestion:I,setQuestionInfo:O,resetQuestionInfo:F,...L}=e;(0,i.useEffect)(()=>{u||(m(!1),N(!1))},[u,m,N]);let W=async(e,t,n)=>{a.k.info("[handleUserResponse] Start",{clinicType:e,isYes:t,customText:n});let o={text:n||(t?"Yes":"No"),sender:"user",timestamp:new Date().toLocaleTimeString()};if(await w(o),await new Promise(e=>setTimeout(e,50)),"AN"===e){if(t)try{a.k.info("[handleUserResponse] Loading data for ST",I.code,I.teacherCode);let e=await b("ST",I.code);if(a.k.info("[handleUserResponse] ST data received:",e),!e||0===e.length){a.k.info("[handleUserResponse] No ST data available");return}let t=e.filter((t,n)=>e.findIndex(e=>e.content===t.content)===n);for(let e of(k(t),t)){var i;a.k.info("[handleUserResponse] About to stream message",{code:e.code,content:e.content,variations:null===(i=e.variations)||void 0===i?void 0:i.length}),await T({isOnlyText:!1,text:"",message:e,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("[handleUserResponse] Message streamed successfully")}a.k.info("[handleUserResponse] Before setting ST type"),S("ST"),E(!0),a.k.info("[handleUserResponse] After setting ST type")}catch(e){a.k.info("[handleUserResponse] Error:",e)}else{let e=Q[Math.floor(Math.random()*Q.length)];await T({isOnlyText:!0,text:e,message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),N(!0)}}else if("ST"===e){if(a.k.info("[handleUserResponse] Handling ST response",{isYes:t}),a.k.info("[handleUserResponse] ST clinic type"),t){await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await b("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),L.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}}else try{let e=await b("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),L.setClinicDEData(t),x(t),S("DE"),E(!0),m(!1);let o=t[g];if(a.k.info("Current Node:",o),!o.isVariationsShown){a.k.info("Showing Node Variations First Time"),a.k.info("Node to show:",o),L.setClinicDEData([o]);let e=U[Math.floor(Math.random()*U.length)];for(let t of(await T({isOnlyText:!0,text:e,message:null,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1}),[o]))a.k.info("Streaming Node Message:",t),await T({isOnlyText:!1,text:"",message:t,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});a.k.info("Marking variations as shown"),t[g]={...o,isVariationsShown:!0};return}}catch(e){console.error("Failed to get DE clinic data:",e)}}};return(0,o.jsxs)("div",{className:"px-[16px] pb-[8px]",children:["AN"===d&&(0,o.jsx)("div",{children:(0,o.jsx)(M,{onUserResponse:W,showNextButton:D,currentQuestion:I})}),"ST"===d&&(0,o.jsx)("div",{children:(0,o.jsx)(P,{...L,getClinicData:b,currentQuestion:I,addMessage:w,setClinicType:S,setChangeClinicType:E,streamText:T,onUserResponse:W,deResponseType:h,setDeResponseType:m,structuredBNodes:f,setStructuredBNodes:x})}),"DE"===d&&(0,o.jsxs)(o.Fragment,{children:[(null===(t=L.clinicDEData[0])||void 0===t?void 0:t.depth)==="B"&&(0,o.jsx)(j,{setClinicType:S,currentQuestion:I,deResponseType:h,nodes:L.clinicDEData,setChangeClinicType:E,setClinicDEData:L.setClinicDEData,streamText:T,addMessage:w,currentBNodeIndex:g,setCurrentBNodeIndex:p,structuredBNodes:f,currentGroupIndex:y,setCurrentGroupIndex:C,resetQuestionInfo:F}),(null===(n=L.clinicDEData[0])||void 0===n?void 0:n.depth)==="C"&&(0,o.jsx)(R,{currentQuestion:I,setClinicType:S,structuredBNodes:f,nodes:L.clinicDEData,currentBNodeIndex:g,setCurrentBNodeIndex:p,setChangeClinicType:E,streamText:T,addMessage:w,setClinicDEData:L.setClinicDEData,setDeResponseType:m,currentGroupIndex:y,setCurrentGroupIndex:C,resetQuestionInfo:F}),(null===(s=L.clinicDEData[0])||void 0===s?void 0:s.depth)==="keyword"&&(0,o.jsx)(A,{currentQuestion:I,currentKeywordCode:L.clinicDEData[0].code,setChangeClinicType:E,setDeResponseType:m,streamText:T,addMessage:w,setClinicDEData:L.setClinicDEData,nodes:L.clinicDEData,onContinue:async()=>{let e=g+1;e>=f.length&&(a.k.warn("No more nodes available:",{currentIndex:g,totalNodes:f.length}),F(),await T({isOnlyText:!0,text:"The clinic has ended. Now, try solving the problem again.",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),S("END"),E(!0),await new Promise(e=>setTimeout(e,500)));let t=f[e];if(a.k.info("Selected Node with Children:",t),null==t?void 0:t.children){let e=Object.keys(t.children)[0];a.k.info("First Group Name:",e);let n=t.children[e];for(let e of(a.k.info("First Group Messages:",n),n))a.k.info("Streaming Message:",e),await T({isOnlyText:!1,text:"",message:e,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await T({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("Setting States - currentBNodeIndex:",1),E(!0),L.setClinicDEData(n),p(g+1)}}}),(null===(l=L.clinicDEData[0])||void 0===l?void 0:l.depth)==="clip"&&(0,o.jsx)(B,{addMessage:w,onContinue:async()=>{let e=f[g];if(a.k.info("Selected Node with Children:",e),null==e?void 0:e.children){let t=Object.keys(e.children)[0];a.k.info("First Group Name:",t);let n=e.children[t];for(let e of(a.k.info("First Group Messages:",n),n))a.k.info("Streaming Message:",e),await T({isOnlyText:!1,text:"",message:e,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});await T({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),a.k.info("Setting States - currentBNodeIndex:",g),E(!0),L.setClinicDEData(n),p(g)}}})]}),"MQ"===d&&(0,o.jsx)("div",{className:"flex flex-row gap-2",children:"Notfound"===_?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:async()=>{let e={text:"From Beginning",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),S("AN"),E(!0),await v()},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"From Beginning"}),(0,o.jsx)("button",{onClick:async()=>{let e={text:"Continue Explanation",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await b("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),L.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"Continue Explanation"})]}):"Fail"===_?(0,o.jsx)("button",{onClick:async()=>{let e={text:"Continue Explanation",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await b("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),L.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"Continue Explanation"}):null}),"HINT"===d&&(0,o.jsx)("div",{className:"flex flex-row gap-2",children:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:async()=>{let e={text:"Yes",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e);let t=await b("DE",I.code),n=[],o=null;t.forEach(e=>{if("B"===e.depth){let t={...e,children:{},isVariationsShown:!1};n.push(t),o=t}else if("C"===e.depth&&o){let t=e.group_name||"default";o.children[t]||(o.children[t]=[]),o.children[t].push(e)}});let i=n.findIndex(e=>e.code===I.clinicCode);if(-1!==i){let e=n[i];if(await T({isOnlyText:!0,text:I.introText||"",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1,audioURL:I.introTTS}),await new Promise(e=>setTimeout(e,500)),x(n),S("DE"),E(!0),m(!0),e.children){let t=Object.keys(e.children)[0],n=e.children[t];for(let e of(L.setClinicDEData(n),n))a.k.info("[initialize] streamText",e),await T({isOnlyText:!1,text:"",message:e,teacherCode:I.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await T({isOnlyText:!0,text:"Is there anything that you're unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1}),p(i)}}},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"Yes"}),(0,o.jsx)("button",{onClick:async()=>{let e={text:"No",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),await T({isOnlyText:!0,text:"Which part are you unsure about?",message:null,teacherCode:I.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1});try{let e=await b("DE",I.code),t=[],n=null;e.forEach(e=>{if("B"===e.depth){let o={...e,children:{},isVariationsShown:!1};t.push(o),n=o}else if("C"===e.depth&&n){let t=e.group_name||"default";n.children[t]||(n.children[t]=[]),n.children[t].push(e)}}),a.k.info("structuredBNodes",t),L.setClinicDEData(t),x(t),S("DE"),E(!0),m(!0)}catch(e){a.k.info("[handleUserResponse] Error loading DE data:",e)}},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm  rounded-lg",children:"No"})]})}),"END"===d&&(0,o.jsx)("div",{className:"flex flex-row gap-2",children:(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("button",{onClick:async()=>{let e={text:"From Beginning",sender:"user",timestamp:new Date().toLocaleTimeString()};await w(e),S("AN"),E(!0),await v()},className:"min-w-[100px] bg-[#F3F3F3] text-gray-800 px-4 py-2 text-sm rounded-lg",children:"From Beginning"})})})]})};var H=n(48034);let V=!1,G=()=>{let[e,t]=(0,i.useState)(!1),[o,s]=(0,i.useState)([]),[l,r]=(0,i.useState)([]),[c,d]=(0,i.useState)({code:"",teacherCode:"",clinicCode:null,hintText:null,introText:null,hintTTS:null,introTTS:null}),[u,h]=(0,i.useState)(null);(0,i.useEffect)(()=>{{if(!c.code||!c.teacherCode){a.k.warn("⚠️ [localStorage] Preventing empty save:",c);return}let e=localStorage.getItem("currentQuestion"),t=e?JSON.parse(e):null;if(t&&t.code===c.code&&t.teacherCode===c.teacherCode&&t.clinicCode===c.clinicCode)return;localStorage.setItem("currentQuestion",JSON.stringify(c)),a.k.info("\uD83D\uDD04 [localStorage] Updated:",c)}},[c]);let m=(0,i.useCallback)(()=>l.length>0,[l]),g=(0,i.useCallback)(async(e,t)=>{try{if(m())return a.k.info("\uD83D\uDD35 [loadOriginalData] Data already loaded:",{dataLength:l.length}),l;a.k.info("\uD83D\uDD35 [loadOriginalData] Loading new data for:",{questionCode:e,teacherCode:t});let o=await n(44415)("./".concat(e,".json"));if(!(null==o?void 0:o.default)||!Array.isArray(o.default))throw Error("Invalid data format for ".concat(e));let i=o.default;return r(i),s(i),a.k.info("\uD83D\uDD35 [loadOriginalData] New data loaded:",{length:i.length}),i}catch(e){throw a.k.error("❌ [loadOriginalData] Error:",e),e}},[l,m]),p=async(e,t)=>{try{a.k.info("\uD83D\uDD0D [getClinicData] Current state:",{currentQuestionCode:c.code,currentTeacherCode:c.teacherCode,requestedCode:t,type:e}),c.teacherCode||a.k.warn("⚠️ [getClinicData] teacherCode is empty!");let o=t||c.code,i=c.teacherCode;a.k.debug("getClinicData","Loading data for:",{type:e,code:o,teacherCode:i}),m()||await g(o,i);let s=await n(44415)("./".concat(o,".json"));if(!(null==s?void 0:s.default)||!Array.isArray(s.default))throw Error("Invalid data format for ".concat(o));let l=s.default,r=l.filter(t=>t.clinic_type===e);return a.k.debug("getClinicData","Filtered results:",{type:e,totalCount:l.length,filteredCount:r.length}),r}catch(e){return a.k.error("getClinicData","Error:",e),[]}},f=(0,i.useCallback)((e,t,n,o,i,s,l)=>{a.k.info("\uD83D\uDD0D [setQuestionInfo] Before update:",{prevState:c,newValues:{code:e,teacherCode:t,clinicCode:n,hintText:o,introText:i,hintTTS:s,introTTS:l}}),d(r=>{let c={code:e,teacherCode:void 0!==t?t:r.teacherCode,clinicCode:void 0===n?r.clinicCode:n,hintText:void 0!==o?o:r.hintText,introText:void 0!==i?i:r.introText,hintTTS:void 0!==s?s:r.hintTTS,introTTS:void 0!==l?l:r.introTTS};return a.k.info("\uD83D\uDD0D [setQuestionInfo] State updated:",{prevState:r,newState:c}),c})},[]);return(0,i.useRef)(!1),(0,i.useEffect)(()=>{},[]),(0,i.useEffect)(()=>{async function e(e){a.k.info("[eventHandler] Received event:",e);try{if(!e.detail){a.k.info("⚠️ [eventHandler] No event detail");return}let{type:n,data:o}=e.detail;if(a.k.info("\uD83D\uDD35 [eventHandler] Processing event:",{type:n,data:o}),n===w.Q.FTOW_CLINICK){V||(localStorage.removeItem("currentQuestion"),a.k.info("\uD83D\uDD04 [eventHandler] Initial localStorage clear"),V=!0);let e="string"==typeof o?o:o.questionCode,n="string"==typeof o?c.teacherCode:o.teacherCode,i="string"==typeof o?null:o.clinicCode,s="string"==typeof o?null:o.hintText,l="string"==typeof o?null:o.introText,r="string"==typeof o?null:o.hintTTS,d="string"==typeof o?null:o.introTTS;a.k.info("\uD83D\uDD35 [eventHandler] Loading data for:",{questionCode:e,teacherCode:n,clinicCode:i,hintText:s,introText:l,hintTTS:r,introTTS:d}),e&&(t(!0),await g(e,n),f(e,n,i,s,l,r,d),t(!1))}else if(n===w.Q.FTOW_CLINIC_START_MIDLE_QUESTION){if(a.k.info("\uD83D\uDD35 [eventHandler] Middle question start"),h(null),console.log("setMiddleQuestionStatus init",u),o&&"object"==typeof o){let{status:e,clinicCode:n,hintText:i,introText:s,hintTTS:l,introTTS:r}=o;a.k.info("\uD83D\uDD35 [eventHandler] Loading middle question data:",{status:e,clinicCode:n,hintText:i,introText:s,hintTTS:l,introTTS:r});let c=localStorage.getItem("currentQuestion");if(c){let{code:o,teacherCode:d}=JSON.parse(c);a.k.info("\uD83D\uDD35 [eventHandler] Using saved question info:",{questionCode:o,teacherCode:d,clinicCode:n}),t(!0),f(o,d,n,i,s,l,r),await new Promise(e=>setTimeout(e,0)),h(e),t(!1)}else a.k.warn("⚠️ [eventHandler] No saved question info found in localStorage")}}else a.k.info("⚠️ [eventHandler] Unknown event type:",n)}catch(e){a.k.error("[eventHandler] Error:",e),t(!1)}}return window.addEventListener(w.Q.FTOW_EVENT_NAME,e),H.d.onEvent(e=>{a.k.info("✅ [eventStore] Event received:",e);try{window.dispatchEvent(new CustomEvent(w.Q.FTOW_EVENT_NAME,{detail:{type:e.type,data:e.data}})),a.k.info("✅ [eventStore] Event dispatched successfully")}catch(e){a.k.info("❌ [eventStore] Failed to dispatch event:",e)}}),H.d.setReady(),()=>{window.removeEventListener(w.Q.FTOW_EVENT_NAME,e),a.k.info("\uD83D\uDD35 [useEffect cleanup] Preserving originalData:",{exists:!!l,length:l.length})}},[]),{getClinicData:p,loading:e,clinicData:o,setClinicData:s,originalData:l,currentQuestion:c,setQuestionInfo:f,middleQuestionStatus:u,resetQuestionInfo:(0,i.useCallback)(()=>{d(e=>({code:e.code,teacherCode:e.teacherCode,clinicCode:null,hintText:null,introText:null,hintTTS:null,introTTS:null})),h(null)},[])}};var q=()=>{let[e,t]=(0,i.useState)("AI_TEACHER"),{messages:n,streamText:s,addMessage:l}=c(),{getClinicData:r,clinicData:d,setClinicData:u,currentQuestion:h,middleQuestionStatus:m,setQuestionInfo:g,resetQuestionInfo:p}=G(),[f,x]=(0,i.useState)([]),[y,C]=(0,i.useState)("AN"),w=(0,i.useRef)(!1),[T,S]=(0,i.useState)(!1),[E,k]=(0,i.useState)([]),[D,N]=(0,i.useState)(!1),[_,v]=(0,i.useState)(0),[b,j]=(0,i.useState)(0),[Q,U]=(0,i.useState)(!1),[O,F]=(0,i.useState)(null),L=(0,i.useCallback)(e=>{F(()=>e)},[]),R=async()=>{try{if(!h.code){a.k.info("[initialize] Waiting for question code");return}if(null!==m){a.k.info("[initialize] Skipping due to middle question handling");return}if(S(!0),h.clinicCode)C("HINT"),await s({isOnlyText:!0,text:h.hintText||"",message:null,teacherCode:h.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1,audioURL:h.hintTTS});else{let e=await r("AN",h.code),t=e.filter((t,n)=>e.findIndex(e=>e.content===t.content)===n);for(let e of(u(t),t))await s({isOnlyText:!1,text:"",message:e,teacherCode:h.teacherCode,hasChoiceButtons:!1,clipSet:null,isMiddleQuestion:!1});await s({isOnlyText:!0,text:"Do you understand everything so far?",message:null,teacherCode:h.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!1})}w.current=!0}catch(e){console.error("[initialize] Error:",e),S(!0)}};return(0,i.useEffect)(()=>{a.k.info("[ClinicChatbotClient] useEffect",{currentQuestion:h}),h.code&&R()},[h.code,h.clinicCode]),(0,i.useEffect)(()=>{(async()=>{a.k.info("[ClinicChatbotClient] State update:",{clinicType:y,changeClinicType:T,messages:n.length,currentQuestion:h,middleQuestionStatus:m}),h.code&&h.teacherCode&&("Success"===m?(a.k.info("[ClinicChatbotClient] Middle question started successfully"),R()):"Notfound"===m?(a.k.info("[ClinicChatbotClient] Middle question not found"),await s({isOnlyText:!0,text:"Sorry, I didn't fully understand. Could you clarify a bit more, or should I start from the beginning?",message:null,teacherCode:h.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!0}),C("MQ"),S(!0)):"Fail"===m&&(a.k.info("[ClinicChatbotClient] Middle question failed"),await s({isOnlyText:!0,text:"I'm sorry, but I can only answer questions related to this problem. For general inquiries, please use the chatbot on the main page.",message:null,teacherCode:h.teacherCode,hasChoiceButtons:!0,clipSet:null,isMiddleQuestion:!0,audioURL:null}),C("MQ"),S(!0)))})()},[m]),(0,o.jsxs)("div",{className:"clinic-chat-container mx-auto h-screen flex flex-col p-4 overflow-y-auto text-black",children:[!1,(0,o.jsx)("div",{className:"flex-shrink-0 p-[16px] pt-[12px] border-b border-[#f5f5f5] justify-start",children:[{id:"AI_TEACHER",label:"AI Teacher"},{id:"NOTIFICATION",label:"Notification"},{id:"WRONG_ANSWER",label:"Incorrect Solutions"},{id:"WEAKNESS",label:"Weakness Analysis"}].map(t=>(0,o.jsx)("button",{onClick:()=>{},className:"border px-[18px] w-min py-[10px] rounded-[6px] font-medium text-[13px] text-center ".concat(e===t.id?"border-[#ebebeb] text-[#333]":"border-transparent text-[#767676]"),children:t.label},t.id))}),(0,o.jsx)("div",{className:"flex-1 min-h-0",children:(0,o.jsx)(I,{messages:n,onShowNext:L,children:(0,o.jsx)("div",{className:"w-full",children:(0,o.jsx)(W,{messages:n,showNextMessage:O,clinicType:y,changeClinicType:T,setChangeClinicType:S,deResponseType:D,setDeResponseType:N,clinicData:d,clinicDEData:f,currentBNodeIndex:_,setCurrentBNodeIndex:v,setClinicData:u,setClinicDEData:x,structuredBNodes:E,setStructuredBNodes:k,setClinicType:C,streamText:s,addMessage:l,currentGroupIndex:b,setCurrentGroupIndex:j,showNextButton:Q,setShowNextButton:U,middleQuestionStatus:m,initialize:R,getClinicData:r,currentQuestion:h,setQuestionInfo:g,resetQuestionInfo:p})})})})]})};function z(){return(0,i.useEffect)(()=>{window.learnScreenEventChannel=function(e,t){H.d.addEvent({type:e,data:JSON.parse(JSON.stringify(t))})}},[]),(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)("div",{children:"Loading..."}),children:(0,o.jsx)(q,{})})}},63090:function(e,t,n){"use strict";function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];try{let t=n.map(e=>{if("object"==typeof e)try{return JSON.stringify(e,null,2)}catch(e){return"[Complex Object]"}return String(e)}).join(" ");console.log("".concat(e,": ").concat(t))}catch(e){console.error("Logger Error:",e)}}n.d(t,{k:function(){return i}});let i={info:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("ℹ️ [".concat(e,"]"),...n)},success:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("✅ [".concat(e,"]"),...n)},warn:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("⚠️ [".concat(e,"]"),...n)},error:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("❌ [".concat(e,"]"),...n)},debug:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return o("\uD83D\uDD35 [".concat(e,"]"),...n)}}},37440:function(e,t,n){"use strict";n.d(t,{cn:function(){return l},dz:function(){return c},l_:function(){return d},lr:function(){return h},q1:function(){return u}});var o=n(48388);n(7395);var i=n(44839),a=n(96164),s=n(27776);function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,i.W)(t))}let r=()=>!!window.flutter_inappwebview,c=async function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(r())try{return JSON.parse(await window.flutter_inappwebview.callHandler(e,...n.map(e=>JSON.stringify(e))))}catch(e){throw console.error("Error calling Flutter handler:",e),e}return null},d=e=>{let t=document.createElement("img");return t.id="question-result-mark",t.src=e,t.className="question-is-correct-mark",t.style.width="60px",t.style.height="60px",t.style.margin="0px",t},u=e=>null!=e?e.replace(/\$\$(.*?)\$\$|\$(.*?)\$/g,(e,t,n)=>{let i=e.startsWith("$$");try{return o.Z.renderToString(t||n,{displayMode:i,throwOnError:!1,macros:{"\\frac":"\\dfrac"}})}catch(e){return console.error("LaTeX rendering error:",e),'<span style="color: red;">[LaTeX Error: '.concat(e instanceof Error?e.message:String(e),"]</span>")}}):e,h=()=>{(0,s.A)("Some features limited due to network restrictions. This is the CES version of Chalk",{duration:3e3,id:"develop"})}},66648:function(e,t,n){"use strict";n.d(t,{default:function(){return i.a}});var o=n(55601),i=n.n(o)},55601:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return r},getImageProps:function(){return l}});let o=n(99920),i=n(80497),a=n(38173),s=o._(n(21241));function l(e){let{props:t}=(0,i.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let r=a.Image},48034:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var o=n(63090);class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}addEvent(e){o.k.info("[EventStore] Adding event:",e),this.isReady?this.callbacks.forEach(t=>t(e)):this.eventQueue.push(e)}setReady(){this.isReady=!0,this.processQueue()}onEvent(e){this.callbacks.push(e)}processQueue(){for(;this.eventQueue.length>0;){let e=this.eventQueue.shift();e&&this.callbacks.forEach(t=>t(e))}}constructor(){this.eventQueue=[],this.isReady=!1,this.callbacks=[]}}let a=i.getInstance()},56106:function(e,t,n){"use strict";var o,i;n.d(t,{Q:function(){return o}}),(i=o||(o={})).FTOW_EVENT_NAME="flutterEvent",i.FTOW_DRAW_QUESTION="DRAW_QUESTION",i.FTOW_SELECT_ANSWER="SELECT_ANSWER",i.FTOW_QUESTION_LIST="QUESTION_PREVIEW_LIST",i.FTOW_RESULT_LIST="RESULT_PREVIEW_LIST",i.FTOW_CHAT_INPUT="CHAT_INPUT",i.WTOF_GENERATE_BUTTONS="GENERATE_BUTTONS",i.WTOF_PAGE_HEIGHT="PAGE_HEIGHT",i.WTOF_HIGHLIGHT="HIGHLIGHT",i.FTOW_CLINIC_DATA="FTOW_CLINIC_DATA",i.FTOW_CLINIC_DE_DATA="FTOW_CLINIC_DE_DATA",i.WTOF_CLINIC_TYPE_CHANGE="CLINIC_TYPE_CHANGE",i.WTOF_REQUEST_DE_DATA="REQUEST_DE_DATA",i.WTOF_REQUEST_KEYWORD="REQUEST_KEYWORD",i.FTOW_KEYWORD_DATA="KEYWORD_DATA",i.FTOW_CLINICK="CILINIC_INIT",i.WTOF_CLINICK_HIGHLIGHT="CLINIC_HIGHLIGHT",i.FTOW_EXPLAIN="EXPLAIN",i.FTOW_DRAW_QUIZ="DRAW_QUIZ",i.FTOW_CHECK_QUIZ="CHECK_QUIZ",i.WTOF_RESULT_QUIZ="RESULT_QUIZ",i.WTOF_CHAT_VIDEO_CLICK="CHAT_VIDEO_CLICK",i.FTOW_TEACHER_ID="TEACHER_ID",i.CTOF_CLINIC_HIGHTLIGHT="CLINIC_HIGHLIGHT_FOR_FLUTTER",i.FTOW_QUIZ_ANSWER="QUIZ_INPUT",i.CTOF_CLINIC_EVENT_RESPOONSE="CLINIC_EVENT_RESPOONSE_FOR_FLUTTER",i.FTOW_CLINIC_START_MIDLE_QUESTION="CLINIC_START_MIDLE_QUESTION",i.WTOF_CONVERT_TEXT_REQUEST="CONVERT_TEXT_REQUEST",i.FTOW_CONVERT_TEXT_RESPONSE="CONVERT_TEXT_RESPONSE"}},function(e){e.O(0,[5864,3954,1351,4868,8173,2971,7023,1744],function(){return e(e.s=86869)}),_N_E=e.O()}]);